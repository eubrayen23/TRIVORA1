<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Trivora ‚Äî Marketplace</title>
<meta name="description" content="Trivora ‚Äî Mobilidade, Tecnologia e Estilo. Carros, Motorizadas, Telefones, Eletr√≥nicos, Moda e Servi√ßos.">
<!-- ===========================
     CSS: Preto & Branco minimalista (com anima√ß√µes)
     =========================== -->
<style>
:root{
  --bg:#ffffff; --fg:#0b0b0b; --muted:#6c6c6c; --accent:#000;
  --soft:#f6f6f6; --card:#fff; --radius:14px; --container:1200px;
  --transition:200ms cubic-bezier(.2,.9,.3,1);
}
*{box-sizing:border-box}
html,body{height:100%}
body{
  margin:0;font-family:Inter, ui-sans-serif, system-ui, -apple-system,"Segoe UI",Roboto,Helvetica,Arial;
  color:var(--fg); background:var(--bg); -webkit-font-smoothing:antialiased;
  -moz-osx-font-smoothing:grayscale; line-height:1.45;
}
a{text-decoration:none;color:inherit}
img{display:block;max-width:100%}
.container{max-width:var(--container);margin:0 auto;padding:0 20px}

/* Header */
.header{
  position:sticky;top:0;z-index:1200;background:#000;color:#fff;border-bottom:1px solid rgba(255,255,255,0.04);
  backdrop-filter: blur(6px);
}
.header-inner{display:flex;align-items:center;justify-content:space-between;padding:12px 0;gap:12px}
.brand{font-weight:900;letter-spacing:2px;font-size:1.4rem}
.top-controls{display:flex;align-items:center;gap:10px}
.nav{display:flex;gap:8px;align-items:center}
.nav a{padding:8px 10px;border-radius:8px;opacity:.98;transition:all var(--transition)}
.nav a:hover,.nav a.active{background:rgba(255,255,255,0.06)}

/* Search */
.search{display:flex;align-items:center;background:#101010;padding:6px;border-radius:10px}
.search input{border:0;background:transparent;color:#fff;padding:8px 10px;outline:none;min-width:140px}
.search button{border:0;background:transparent;color:#fff;padding:8px 10px;cursor:pointer}

/* Banner / slider */
.banner{margin:18px 0;border-radius:var(--radius);overflow:hidden;position:relative;background:#111;color:#fff}
.slides{min-height:340px;position:relative}
.slide{position:absolute;inset:0;display:none;padding:28px;align-items:center;justify-content:center;text-align:center}
.slide.active{display:flex;animation:fadeUp .6s ease}
@keyframes fadeUp{from{opacity:0;transform:translateY(8px)}to{opacity:1;transform:none}}
.slide h1{font-size:2.2rem;margin:0 0 8px}
.slide p{color:#d1d1d1;margin:0}

/* Slider dots */
.slider-dots{position:absolute;left:50%;transform:translateX(-50%);bottom:12px;display:flex;gap:8px}
.dot{width:10px;height:10px;border-radius:999px;background:rgba(255,255,255,0.18);cursor:pointer}
.dot.active{background:#fff}

/* Categories */
.categories{display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:18px;margin:22px 0}
.cat-card{background:var(--card);border:1px solid #eee;border-radius:12px;overflow:hidden;display:flex;flex-direction:column;transition:transform .28s,box-shadow .28s;box-shadow:0 10px 30px rgba(0,0,0,0.04)}
.cat-card:hover{transform:translateY(-6px);box-shadow:0 20px 60px rgba(0,0,0,0.06)}
.cat-media{height:160px;overflow:hidden}
.cat-media img{width:100%;height:100%;object-fit:cover;transition:transform .35s}
.cat-card:hover .cat-media img{transform:scale(1.04)}
.cat-body{padding:12px;display:flex;flex-direction:column;gap:8px}
.cat-body h3{margin:0}
.cat-body p{margin:0;color:var(--muted)}
.cat-body .group{margin-top:auto;display:flex;gap:8px}

/* Cards grid */
.cards{display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:16px}
.card{border-radius:12px;border:1px solid #eee;background:var(--card);overflow:hidden;display:flex;flex-direction:column;transition:transform var(--transition),box-shadow var(--transition)}
.card:hover{transform:translateY(-6px);box-shadow:0 18px 40px rgba(0,0,0,0.06)}
.thumb{height:180px;overflow:hidden}
.thumb img{width:100%;height:100%;object-fit:cover;transition:transform .4s}
.card:hover .thumb img{transform:scale(1.05)}
.meta{padding:12px;display:flex;flex-direction:column;gap:8px;flex:1}
.meta h4{margin:0}
.desc{color:var(--muted);font-size:.95rem;margin:0}
.price{font-weight:800}
.actions{display:flex;gap:8px;padding:12px}
.btn{flex:1;padding:10px;border-radius:10px;border:0;background:#000;color:#fff;cursor:pointer;font-weight:700}
.btn.secondary{background:#f2f2f2;color:#000;border:1px solid #e6e6e6}

/* Tables & forms */
.table{width:100%;border-collapse:collapse}
.table th,.table td{padding:12px;border-bottom:1px solid #eee;text-align:left}
.form{display:grid;gap:12px}
.form input,.form select,.form textarea{padding:10px;border-radius:8px;border:1px solid #ddd}

/* Footer and bottom bar */
footer{margin-top:30px;background:#000;color:#fff;text-align:center;padding:16px}
.footerbar{position:fixed;left:0;right:0;bottom:0;background:#0b0b0b;color:#fff;padding:8px 12px;border-top:1px solid rgba(255,255,255,0.03);display:flex;justify-content:center;gap:14px;z-index:1400}
.footerbar a{color:#fff;padding:8px;border-radius:8px}

/* Modal */
.modal-backdrop{position:fixed;inset:0;background:rgba(0,0,0,0.6);display:none;align-items:center;justify-content:center;z-index:2000}
.modal{background:#fff;border-radius:12px;padding:18px;max-width:720px;width:100%;box-shadow:0 20px 60px rgba(0,0,0,0.12)}
.modal h3{margin:0 0 8px}

/* Toast */
.toast{position:fixed;left:50%;top:18px;transform:translateX(-50%);background:#fff;color:#000;padding:10px 14px;border-radius:8px;box-shadow:0 12px 40px rgba(0,0,0,0.12);z-index:2600}

/* Responsive tweaks */
@media (max-width:900px){
  .slide h1{font-size:1.4rem}
  .brand{font-size:1.05rem}
  .cards{grid-template-columns:repeat(auto-fit,minmax(160px,1fr))}
}
</style>
</head>
<body>
  <!-- HEADER -->
  <header class="header">
    <div class="container header-inner">
      <div style="display:flex;align-items:center;gap:14px">
        <a class="brand" href="#home" data-link>TRIVORA</a>
        <nav class="nav" aria-label="main navigation">
          <a href="#home" class="nav-link" data-link>Home</a>
          <a href="#produtos" class="nav-link" data-link>Produtos</a>
          <a href="#ofertas" class="nav-link" data-link>Ofertas</a>
        </nav>
      </div>
      <div class="top-controls">
        <div class="search" role="search" aria-label="buscar produtos">
          <input id="search-input" placeholder="Buscar produtos..." aria-label="buscar">
          <button id="search-btn" aria-label="buscar">üîç</button>
        </div>
        <a class="minicart" href="#carrinho" data-link aria-label="carrinho">üõí <span id="cart-count">0</span></a>
        <button id="btn-account" class="btn secondary" style="padding:8px 10px">Entrar</button>
      </div>
    </div>
  </header>

  <!-- MAIN -->
  <main class="container" id="app">
    <!-- HOME SLIDER -->
    <section id="home" class="section" aria-labelledby="home-title">
      <div class="banner" role="region" aria-label="promo√ß√µes">
        <div class="slides" id="slides">
          <div class="slide active" data-i="0">
            <div>
              <h1 id="home-title">Trivora ‚Äî Mobilidade & Tecnologia</h1>
              <p class="muted">Destaques em Carros, Motorizadas e Eletr√¥nicos. Navegue livremente ‚Äî fa√ßa login apenas para comprar.</p>
            </div>
          </div>
          <div class="slide" data-i="1">
            <div>
              <h1>Ofertas da Semana</h1>
              <p class="muted">Confira as promo√ß√µes e economize.</p>
            </div>
          </div>
          <div class="slide" data-i="2">
            <div>
              <h1>Espa√ßo de Marketing</h1>
              <p class="muted">Visibilidade premium para o seu produto.</p>
            </div>
          </div>
        </div>
        <div class="slider-dots" id="slider-dots"></div>
      </div>

      <!-- Categories showcase -->
      <section aria-label="categorias" style="margin-top:18px">
        <div style="display:flex;justify-content:space-between;align-items:center">
          <div>
            <h2 style="margin:0">Categorias</h2>
            <p class="muted" style="margin:6px 0 0">Clique numa categoria para ver a vitrine completa.</p>
          </div>
          <div class="kicker">
            <span class="pill" style="padding:6px 10px;border-radius:999px;border:1px solid #eee">Preto & Branco</span>
            <span class="pill" style="padding:6px 10px;border-radius:999px;border:1px solid #eee">Minimal</span>
          </div>
        </div>

        <div class="categories" id="categories"></div>
      </section>
    </section>

    <!-- PRODUCTS PAGE -->
    <section id="produtos" class="section hidden" aria-labelledby="products-title">
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:12px">
        <h1 id="products-title">Todos os Produtos</h1>
        <div>
          <label class="small">Filtrar: </label>
          <select id="filter-select">
            <option value="all">Todas</option>
            <option value="Carros">Carros</option>
            <option value="Motorizadas">Motorizadas</option>
            <option value="Telefones">Telefones</option>
            <option value="Eletronicos">Eletr√¥nicos</option>
            <option value="Masculino">Masculino</option>
            <option value="Feminino">Feminino</option>
            <option value="Infantil">Infantil</option>
            <option value="Beleza">Beleza</option>
            <option value="Servicos">Servi√ßos</option>
            <option value="Marketing">Marketing</option>
          </select>
        </div>
      </div>
      <div id="all-products" class="cards" aria-live="polite"></div>
    </section>

    <!-- Category pages -->
    <section id="carros" class="section hidden"><h1>Carros</h1><div id="cat-carros" class="cards"></div></section>
    <section id="motos" class="section hidden"><h1>Motorizadas</h1><div id="cat-motos" class="cards"></div></section>
    <section id="telefones" class="section hidden"><h1>Telefones</h1><div id="cat-telefones" class="cards"></div></section>
    <section id="eletronicos" class="section hidden"><h1>Eletr√¥nicos</h1><div id="cat-eletronicos" class="cards"></div></section>
    <section id="masculino" class="section hidden"><h1>Moda Masculina</h1><div id="cat-masculino" class="cards"></div></section>
    <section id="feminino" class="section hidden"><h1>Moda Feminina & Beleza</h1><div id="cat-feminino" class="cards"></div></section>
    <section id="infantil" class="section hidden"><h1>Moda Infantil</h1><div id="cat-infantil" class="cards"></div></section>
    <section id="servicos" class="section hidden"><h1>Servi√ßos Online</h1><div id="cat-servicos" class="cards"></div></section>
    <section id="marketing" class="section hidden"><h1>Espa√ßo de Marketing</h1><div id="cat-marketing" class="cards"></div></section>
    <!-- CART -->
    <section id="carrinho" class="section hidden">
      <h1>Seu Carrinho</h1>
      <table class="table" id="cart-table">
        <thead><tr><th>Produto</th><th>Pre√ßo</th><th>Qtd</th><th>Subtotal</th><th></th></tr></thead>
        <tbody></tbody>
        <tfoot><tr><td colspan="3">Total</td><td id="cart-total">Kz 0</td><td></td></tr></tfoot>
      </table>
      <div style="margin-top:12px;display:flex;gap:10px">
        <button class="btn" id="btn-checkout">Finalizar Compra</button>
        <button class="btn secondary" id="btn-clear">Limpar Carrinho</button>
      </div>
    </section>

    <!-- CHECKOUT -->
    <section id="checkout" class="section hidden">
      <h1>Finalizar Compra</h1>
      <div style="display:grid;grid-template-columns:1fr 320px;gap:18px">
        <form id="checkout-form" class="form">
          <input name="name" placeholder="Nome completo" required />
          <input name="email" type="email" placeholder="Email (necess√°rio para confirma√ß√£o)" required />
          <input name="address" placeholder="Endere√ßo" required />
          <input name="phone" placeholder="Telefone" />
          <select name="payment" required>
            <option value="">M√©todo de Pagamento</option>
            <option>Multicaixa</option>
            <option>Unitel Money</option>
            <option>PayPal</option>
            <option>Stripe</option>
          </select>
          <textarea name="notes" placeholder="Observa√ß√µes (opcional)"></textarea>
          <button class="btn" type="submit">Confirmar pedido (simulado)</button>
        </form>

        <aside style="border:1px solid #eee;border-radius:10px;padding:12px">
          <h3>Resumo do pedido</h3>
          <table class="table" id="summary-table"><thead><tr><th>Produto</th><th>Qtd</th><th>Total</th></tr></thead><tbody></tbody><tfoot><tr><td colspan="2">Total</td><td id="summary-total">Kz 0</td></tr></tfoot></table>
        </aside>
      </div>
    </section>

    <!-- CONTA -->
    <section id="conta" class="section hidden">
      <h1>Minha Conta</h1>
      <div id="account-area"></div>
    </section>

  </main>

  <footer>
    ¬© <span id="year"></span> Trivora ‚Äî Mobilidade, Tecnologia & Estilo
  </footer>

  <div class="footerbar" role="navigation" aria-label="barra inferior">
    <a href="#home" data-link>Home</a>
    <a href="#produtos" data-link>Produtos</a>
    <a href="#carrinho" data-link>Carrinho</a>
    <a href="#conta" data-link>Conta</a>
  </div>

  <!-- AUTH MODAL (only opens when needed) -->
  <div id="auth-modal" class="modal-backdrop" aria-hidden="true">
    <div class="modal" role="dialog" aria-modal="true" aria-labelledby="auth-title">
      <h3 id="auth-title">Entrar na Trivora</h3>
      <p class="small muted">Login r√°pido com Google. Ou continue como convidado e fa√ßa checkout usando email.</p>
      <div style="display:flex;gap:8px;flex-wrap:wrap">
        <button id="btn-google" class="btn">Entrar com Google</button>
        <button id="btn-guest" class="btn secondary">Continuar como convidado (pedir email no checkout)</button>
      </div>
      <div style="margin-top:12px"><button id="btn-close-auth" class="btn secondary">Fechar</button></div>
    </div>
  </div>

  <!-- TOAST placeholder -->
  <div id="toast-wrap" style="position:fixed;left:50%;transform:translateX(-50%);top:14px;z-index:3000"></div>

  <!-- ===============================
       JAVASCRIPT (completo)
       - Google login via Firebase (config placeholders)
       - Local fallback for users/orders/cart (localStorage)
       - Full UI rendering and routing
       =============================== -->
  <script type="module">
  /* =========================
     CONFIG
     - Substitua firebaseConfig por teu projeto para ativar login Google
     - Se n√£o quiser usar Firebase, o fallback localStorage funciona
     ========================= */
  const FIREBASE_ENABLED = false; // colocar true para ativar Google Login
  /* FIREBASE CONFIG PLACEHOLDER:
     const firebaseConfig = {
       apiKey: "YOUR_API_KEY",
       authDomain: "YOUR_PROJECT.firebaseapp.com",
       projectId: "YOUR_PROJECT_ID",
       appId: "YOUR_APP_ID"
     };
  */
  // imports only executed if enabled to avoid errors when false
  let firebaseAuth = null;
  if(FIREBASE_ENABLED){
    const { initializeApp } = await import('https://www.gstatic.com/firebasejs/10.14.1/firebase-app.js');
    const { getAuth, signInWithPopup, GoogleAuthProvider, onAuthStateChanged, signOut } = await import('https://www.gstatic.com/firebasejs/10.14.1/firebase-auth.js');
    // place your firebaseConfig here if enabling
    const firebaseConfig = {
      apiKey: "YOUR_API_KEY",
      authDomain: "YOUR_PROJECT.firebaseapp.com",
      projectId: "YOUR_PROJECT_ID",
      appId: "YOUR_APP_ID"
    };
    const app = initializeApp(firebaseConfig);
    firebaseAuth = getAuth(app);
    window._TRIVORA_FIREBASE = { signInWithPopup, GoogleAuthProvider, onAuthStateChanged, signOut, auth: firebaseAuth };
  }

  /* ==============
     DATA: PRODUCTS (expanded)
     ============== */
  const PRODUCTS = [
    {id:'car-tesla',category:'Carros',name:'Tesla Model 3',price:9500000,img:'https://source.unsplash.com/800x600/?tesla,car',desc:'Carro el√©trico moderno.'},
    {id:'car-bmw',category:'Carros',name:'BMW S√©rie 3',price:8200000,img:'https://source.unsplash.com/800x600/?bmw,car',desc:'Performance e luxo.'},
    {id:'moto-r1',category:'Motorizadas',name:'Yamaha R1',price:3200000,img:'https://source.unsplash.com/800x600/?yamaha,motorcycle',desc:'Esportiva de alta performance.'},
    {id:'moto-ninja',category:'Motorizadas',name:'Kawasaki Ninja',price:3000000,img:'https://source.unsplash.com/800x600/?kawasaki,motorcycle',desc:'Desempenho agressivo.'},
    {id:'tel-iphone15',category:'Telefones',name:'iPhone 15 Pro',price:850000,img:'https://source.unsplash.com/800x600/?iphone,phone',desc:'C√¢mera Pro e desempenho.'},
    {id:'tel-samsung-s24',category:'Telefones',name:'Samsung S24',price:620000,img:'https://source.unsplash.com/800x600/?samsung,phone',desc:'Tela AMOLED.'},
    {id:'ele-tv55',category:'Eletronicos',name:'Smart TV 55"',price:300000,img:'https://source.unsplash.com/800x600/?tv,television',desc:'4K HDR e apps.'},
    {id:'ele-laptop',category:'Eletronicos',name:'Laptop Ultrabook',price:540000,img:'https://source.unsplash.com/800x600/?laptop,notebook',desc:'Leve, potente.'},
    {id:'mas-tenis',category:'Masculino',name:'T√™nis Running',price:45000,img:'https://source.unsplash.com/800x600/?mens-shoes',desc:'Amortecimento e estilo.'},
    {id:'mas-jaqueta',category:'Masculino',name:'Jaqueta Bomber',price:46000,img:'https://source.unsplash.com/800x600/?mens-jacket',desc:'Estilo urbano.'},
    {id:'fem-vestido',category:'Feminino',name:'Vestido Floral',price:25000,img:'https://source.unsplash.com/800x600/?dress,women',desc:'Leve e elegante.'},
    {id:'bez-kit',category:'Beleza',name:'Kit Maquiagem',price:15000,img:'https://source.unsplash.com/800x600/?makeup,cosmetics',desc:'Completo.'},
    {id:'inf-conj',category:'Infantil',name:'Conjunto Infantil',price:15000,img:'https://source.unsplash.com/800x600/?kids,clothes',desc:'Maciez e conforto.'},
    {id:'srv-logo',category:'Servicos',name:'Design de Logo',price:20000,img:'https://source.unsplash.com/800x600/?logo,design',desc:'Identidade visual.'},
    {id:'mkt-banner',category:'Marketing',name:'Banner Rotativo',price:7000,img:'https://source.unsplash.com/800x600/?marketing,advertising',desc:'Vitrine na homepage.'}
  ];

  /* ==============
     STORAGE & SESSION (local fallback)
     ============== */
  const LS = {
    cartKey: 'trivora_cart_v1',
    usersKey: 'trivora_users_v1',
    ordersKey: 'trivora_orders_v1',
    sessionKey: 'trivora_session_v1',
    get(k, fallback = null){ try{ const v = localStorage.getItem(k); return v ? JSON.parse(v) : fallback; }catch(e){ return fallback; } },
    set(k, v){ try{ localStorage.setItem(k, JSON.stringify(v)); }catch(e){} },
    remove(k){ try{ localStorage.removeItem(k); }catch(e){} }
  };

  // cart stored as [{id,qty}]
  function cartAll(){ return LS.get(LS.cartKey, []); }
  function cartSave(items){ LS.set(LS.cartKey, items); UI.updateCart(); }
  function cartAdd(id, qty = 1){ const items = cartAll(); const it = items.find(x=>x.id===id); if(it) it.qty += qty; else items.push({id, qty}); cartSave(items); UI.toast('Adicionado ao carrinho'); }
  function cartRemove(id){ cartSave(cartAll().filter(x=>x.id !== id)); }
  function cartSetQty(id, qty){ const items = cartAll(); const it = items.find(x=>x.id===id); if(it){ it.qty = Math.max(1, qty); cartSave(items); } }

  function ordersAll(){ return LS.get(LS.ordersKey, []); }
  function createOrder(order){ const list = ordersAll(); list.push(order); LS.set(LS.ordersKey, list); return order; }

  // session (when using Firebase, we will store firebase user displayName/email in session)
  function getSession(){ return LS.get(LS.sessionKey, null); }
  function setSession(sess){ LS.set(LS.sessionKey, sess); UI.updateAccountUI(); }
  function clearSession(){ LS.remove(LS.sessionKey); UI.updateAccountUI(); }

  /* ==============
     UI render & helpers
     ============== */
  function $(sel, ctx=document){ return ctx.querySelector(sel); }
  function $all(sel, ctx=document){ return Array.from((ctx||document).querySelectorAll(sel)); }
  function formatKz(v){ return 'Kz ' + Number(v).toLocaleString('pt-PT'); }

  const UI = {
    toast(msg, ms=1600){
      const wrap = document.getElementById('toast-wrap');
      const el = document.createElement('div'); el.className='toast'; el.textContent = msg;
      wrap.appendChild(el); setTimeout(()=> el.remove(), ms);
    },
    updateCart(){
      const cnt = cartAll().reduce((n,i)=>n+i.qty,0);
      const total = cartAll().reduce((s,i)=>{ const p = PRODUCTS.find(x=>x.id===i.id); return s + (p?.price||0)*i.qty; },0);
      $('#cart-count').textContent = cnt;
      const cartTotalEl = document.getElementById('cart-total');
      if(cartTotalEl) cartTotalEl.textContent = formatKz(total);
    },
    toast(msg){ UI.toast(msg); },
    updateAccountUI(){ // reflect session to header / account area
      const sess = getSession();
      const btn = document.getElementById('btn-account');
      if(sess){
        btn.textContent = `Ol√°, ${sess.name.split(' ')[0]}`;
        btn.classList.add('secondary');
      } else {
        btn.textContent = 'Entrar';
        btn.classList.remove('secondary');
      }
      // account area
      const area = document.getElementById('account-area');
      if(area){
        if(sess){
          area.innerHTML = `<div style="display:flex;justify-content:space-between;align-items:center">
            <div>
              <h3>${escapeHtml(sess.name||sess.email)}</h3>
              <div class="small muted">${escapeHtml(sess.email||'')}</div>
            </div>
            <div>
              <button id="btn-logout" class="btn secondary">Sair</button>
            </div>
          </div>`;
          $('#btn-logout').addEventListener('click', ()=>{ // logout
            if(FIREBASE_ENABLED && window._TRIVORA_FIREBASE && window._TRIVORA_FIREBASE.signOut){
              window._TRIVORA_FIREBASE.signOut(window._TRIVORA_FIREBASE.auth).catch(()=>{});
            }
            clearSession();
            UI.toast('Sess√£o encerrada');
            location.hash = 'home';
          });
        } else {
          area.innerHTML = `<p class="small muted">Entrar para ver pedidos e dados.</p>`;
        }
      }
    }
  };

  function escapeHtml(s){ return String(s||'').replace(/[&<>"']/g, c=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#039;'})[c]); }

  /* ==============
     Render functions
     ============== */
  function renderSlider(){
    const slides = $all('.slide');
    const dots = $('#slider-dots');
    dots.innerHTML = slides.map((s,i)=> `<div class="dot ${i===0?'active':''}" data-i="${i}"></div>`).join('');
    const dotEls = Array.from(dots.children);
    let idx = 0;
    const show = (i)=>{
      slides.forEach((s,k)=> s.classList.toggle('active', k===i));
      dotEls.forEach((d,k)=> d.classList.toggle('active', k===i));
      idx = i;
    };
    dotEls.forEach(d=> d.addEventListener('click', ()=> show(parseInt(d.dataset.i))));
    setInterval(()=> show((idx+1) % slides.length), 5200);
  }

  function renderCategories(){
    const categories = ['Carros','Motorizadas','Telefones','Eletronicos','Masculino','Feminino','Infantil','Beleza','Servicos','Marketing'];
    const container = document.getElementById('categories');
    container.innerHTML = categories.map(cat=>{
      const rep = PRODUCTS.find(p=>p.category === cat) || {name:cat, desc:'Vitrine ' + cat, img: 'https://source.unsplash.com/900x700/?'+encodeURIComponent(cat)};
      const slug = slugFor(cat);
      return `<article class="cat-card" data-cat="${escapeHtml(cat)}">
        <div class="cat-media"><img src="${rep.img}" alt="${escapeHtml(cat)}"></div>
        <div class="cat-body">
          <h3>${escapeHtml(cat)}</h3>
          <p class="muted">${escapeHtml(rep.name)} ‚Äî <span class="small muted">${escapeHtml(rep.desc)}</span></p>
          <div class="group">
            <a class="btn secondary" href="#${slug}" data-link>Ver todos</a>
            <button class="btn" data-add="${rep.id}">Adicionar</button>
          </div>
        </div>
      </article>`;
    }).join('');
    // bind add buttons
    container.querySelectorAll('[data-add]').forEach(b=> b.addEventListener('click', (e)=>{ const id=e.currentTarget.dataset.add; cartAdd(id,1); renderCartTable(); UI.updateCart(); }));
  }

  function slugFor(cat){ return cat.toLowerCase().replace(/\s+/g,''); }

  function renderProductCard(p){
    return `<article class="card" data-id="${p.id}">
      <div class="thumb"><img src="${p.img}" alt="${escapeHtml(p.name)}"></div>
      <div class="meta">
        <h4>${escapeHtml(p.name)}</h4>
        <div class="desc">${escapeHtml(p.desc)}</div>
        <div class="price">${formatKz(p.price)}</div>
      </div>
      <div class="actions">
        <button class="btn" data-add="${p.id}">Adicionar</button>
        <button class="btn secondary" data-view="${p.id}">Ver</button>
      </div>
    </article>`;
  }

  function renderAllProducts(filter='all'){
    const out = document.getElementById('all-products');
    let list = PRODUCTS.slice();
    if(filter && filter !== 'all') list = list.filter(p=>p.category === filter);
    out.innerHTML = list.map(renderProductCard).join('');
    bindProductActions(out);
  }

  function renderCategoryPage(category, elId){
    const el = document.getElementById(elId);
    if(!el) return;
    const list = PRODUCTS.filter(p=>p.category === category);
    if(list.length === 0){ el.innerHTML = '<div class="muted">Sem produtos nesta categoria.</div>'; return; }
    el.innerHTML = list.map(renderProductCard).join('');
    bindProductActions(el);
  }

  function bindProductActions(root){
    root.querySelectorAll('[data-add]').forEach(b=>{ b.removeEventListener('click', addHandler); b.addEventListener('click', addHandler); });
    root.querySelectorAll('[data-view]').forEach(b=>{ b.removeEventListener('click', viewHandler); b.addEventListener('click', viewHandler); });
  }
  function addHandler(e){ const id = e.currentTarget.dataset.add; cartAdd(id,1); renderCartTable(); UI.updateCart(); }
  function viewHandler(e){ const id = e.currentTarget.dataset.view; const p = PRODUCTS.find(x=>x.id===id); if(p) quickView(p); }

  function quickView(p){
    const md = document.createElement('div'); md.className='modal-backdrop'; md.style.zIndex=5000;
    md.innerHTML = `<div class="modal">
      <div style="display:flex;gap:12px;flex-wrap:wrap">
        <div style="flex:1;min-width:260px"><img src="${p.img}" style="width:100%;height:320px;object-fit:cover;border-radius:8px" alt="${escapeHtml(p.name)}"></div>
        <div style="flex:1;min-width:240px">
          <h3>${escapeHtml(p.name)}</h3>
          <div style="font-weight:800;margin:8px 0">${formatKz(p.price)}</div>
          <p class="muted">${escapeHtml(p.category)}</p>
          <p style="margin-top:10px">${escapeHtml(p.desc)}</p>
          <div style="margin-top:14px;display:flex;gap:8px">
            <button class="btn" id="qv-add">Adicionar</button>
            <button class="btn secondary" id="qv-close">Fechar</button>
          </div>
        </div>
      </div>
    </div>`;
    document.body.appendChild(md);
    md.querySelector('#qv-close').addEventListener('click', ()=> md.remove());
    md.querySelector('#qv-add').addEventListener('click', ()=>{ cartAdd(p.id,1); renderCartTable(); UI.updateCart(); md.remove(); });
  }

  function renderCartTable(){
    const tbody = document.querySelector('#cart-table tbody');
    if(!tbody) return;
    const items = cartAll();
    if(items.length === 0){ tbody.innerHTML = `<tr><td colspan="5" class="muted">Carrinho vazio</td></tr>`; UI.updateCart(); return; }
    tbody.innerHTML = items.map(it=>{
      const p = PRODUCTS.find(x=>x.id===it.id);
      const subtotal = (p?.price||0) * it.qty;
      return `<tr>
        <td style="max-width:320px">${escapeHtml(p.name)}</td>
        <td>${formatKz(p.price)}</td>
        <td><input type="number" min="1" value="${it.qty}" data-id="${it.id}" class="qty" style="width:80px;padding:6px;border-radius:6px;border:1px solid #ddd"></td>
        <td>${formatKz(subtotal)}</td>
        <td><button class="btn secondary" data-remove="${it.id}">Remover</button></td>
      </tr>`;
    }).join('');
    // bind qty & remove
    tbody.querySelectorAll('.qty').forEach(i=>{ i.removeEventListener('input', qtyHandler); i.addEventListener('input', qtyHandler); });
    tbody.querySelectorAll('[data-remove]').forEach(b=>{ b.removeEventListener('click', removeHandler); b.addEventListener('click', removeHandler); });
    UI.updateCart();
  }
  function qtyHandler(e){ const id = e.currentTarget.dataset.id; const val = parseInt(e.currentTarget.value||'1',10); cartSetQty(id, val); renderCartTable(); }
  function removeHandler(e){ const id = e.currentTarget.dataset.remove; cartRemove(id); renderCartTable(); UI.updateCart(); }

  function renderCheckoutSummary(){
    const tb = document.querySelector('#summary-table tbody');
    if(!tb) return;
    const items = cartAll();
    if(items.length === 0){ tb.innerHTML = '<tr><td colspan="3">Carrinho vazio</td></tr>'; document.getElementById('summary-total').textContent='Kz 0'; return; }
    tb.innerHTML = items.map(it=>{
      const p = PRODUCTS.find(x=>x.id===it.id);
      return `<tr><td>${escapeHtml(p.name)}</td><td>${it.qty}</td><td>${formatKz((p.price||0)*it.qty)}</td></tr>`;
    }).join('');
    const total = items.reduce((s,i)=>{ const p = PRODUCTS.find(x=>x.id===i.id); return s + ((p?.price||0) * i.qty); },0);
    document.getElementById('summary-total').textContent = formatKz(total);
  }

  /* ==============
     AUTH (Google via Firebase optional) & guest flow
     ============== */
  const authModal = document.getElementById('auth-modal');
  const btnAccount = document.getElementById('btn-account');
  const btnGoogle = document.getElementById('btn-google');
  const btnGuest = document.getElementById('btn-guest');
  const btnCloseAuth = document.getElementById('btn-close-auth');

  // show modal when account clicked and not logged
  btnAccount.addEventListener('click', (e)=>{
    const sess = getSession();
    if(sess){
      location.hash = 'conta';
    } else {
      openAuthModal();
    }
  });

  function openAuthModal(){ authModal.style.display = 'flex'; authModal.setAttribute('aria-hidden','false'); }
  function closeAuthModal(){ authModal.style.display = 'none'; authModal.setAttribute('aria-hidden','true'); }

  btnCloseAuth.addEventListener('click', closeAuthModal);

  // Guest flow: when guest chosen, we set a guest session (name=Convidado) but require email at checkout
  btnGuest.addEventListener('click', ()=>{
    const guest = {type:'guest', name:'Convidado', email:null};
    setSession(guest);
    UI.updateAccountUI();
    UI.toast('Continuando como convidado. O email ser√° solicitado no checkout.');
    closeAuthModal();
  });

  // Google login action
  if(FIREBASE_ENABLED && window._TRIVORA_FIREBASE){
    btnGoogle.addEventListener('click', async ()=>{
      try{
        const provider = new window._TRIVORA_FIREBASE.GoogleAuthProvider();
        const result = await window._TRIVORA_FIREBASE.signInWithPopup(window._TRIVORA_FIREBASE.auth, provider);
        const user = result.user;
        // create session
        setSession({ type:'user', uid: user.uid, name: user.displayName, email: user.email });
        UI.toast(`Bem-vindo(a), ${user.displayName}`);
        closeAuthModal();
      }catch(err){
        console.error(err);
        UI.toast('Falha no login Google: ' + (err.message||err));
      }
    });

    // observe state
    window._TRIVORA_FIREBASE.onAuthStateChanged(window._TRIVORA_FIREBASE.auth, (u)=>{
      if(u){ setSession({ type:'user', uid:u.uid, name:u.displayName, email:u.email }); UI.updateAccountUI(); } else { /* signed out */ }
    });
  } else {
    // Firebase disabled -> Google button does local mock (for demo): opens prompt for name+email
    btnGoogle.addEventListener('click', ()=>{
      const name = prompt('Nome (simula√ß√£o Google):'); if(!name) return;
      const email = prompt('Email (simula√ß√£o Google):'); if(!email) return;
      // create local user if not exists
      const users = LS.get(LS.usersKey, []);
      let u = users.find(x=>x.email === email);
      if(!u){ u = { id:'u'+Date.now(), name, email, status:'active' }; users.push(u); LS.set(LS.usersKey, users); }
      setSession({ type:'user', uid:u.id, name:u.name, email:u.email });
      UI.toast('Login simulado efectuado: ' + name);
      closeAuthModal();
    });
  }

  /* ==============
     Checkout flow (require login or guest email)
     ============== */
  document.getElementById('btn-checkout').addEventListener('click', ()=>{
    const sess = getSession();
    if(!sess){
      // ask login modal
      openAuthModal();
      UI.toast('Fa√ßa login ou continue como convidado para finalizar a compra.');
      return;
    }
    // if guest without email, open checkout and require email there
    location.hash = 'checkout';
    renderCheckoutSummary();
  });

  document.getElementById('checkout-form').addEventListener('submit', (e)=>{
    e.preventDefault();
    const form = new FormData(e.target); const data = Object.fromEntries(form.entries());
    const items = cartAll();
    if(items.length === 0){ UI.toast('Carrinho vazio'); return; }
    const sess = getSession();
    // if guest, ensure email provided
    if(sess && sess.type === 'guest' && (!data.email || data.email.trim()==='')){ UI.toast('Por favor forne√ßa o seu email para confirma√ß√£o'); return; }
    // create order
    const total = items.reduce((s,i)=>{ const p = PRODUCTS.find(x=>x.id===i.id); return s + ((p?.price||0) * i.qty); },0);
    const order = {
      id: 'TRV-' + Date.now(),
      items,
      total,
      customer: { name: data.name, email: data.email, phone: data.phone, address: data.address },
      status: 'Pago (simulado)',
      createdAt: new Date().toISOString()
    };
    createOrder(order);
    cartSave([]); renderCartTable(); UI.updateCart();
    UI.toast('Pedido confirmado (simulado): ' + order.id);
    // redirect to account/orders
    setTimeout(()=> { location.hash = 'conta'; renderAccountOrders(order); }, 700);
  });

  /* ==============
     Account orders & admin approve UI (local)
     ============== */
  function renderAccountOrders(latestOrder){
    const sess = getSession();
    const area = document.getElementById('account-area');
    if(!area) return;
    if(!sess){ area.innerHTML = '<div class="small muted">Fa√ßa login para ver seus pedidos</div>'; return; }
    const orders = ordersAll().filter(o => (o.customer && (o.customer.email === sess.email)));
    area.innerHTML = `<div><h3>Ol√°, ${escapeHtml(sess.name||sess.email)}</h3><div class="small muted">${escapeHtml(sess.email||'')}</div></div>
      <div style="margin-top:12px">
        <h4>Seus pedidos</h4>
        <div id="my-orders">${orders.length ? orders.map(o=>`<div style="border:1px solid #eee;padding:8px;border-radius:8px;margin-bottom:8px">${o.id} ‚Äî ${new Date(o.createdAt).toLocaleString()} ‚Äî ${formatKz(o.total)} ‚Äî ${o.status}</div>`).join('') : '<div class="small muted">Sem pedidos</div>'}</div>
      </div>`;
    // logout button added via UI.updateAccountUI
  }

  function renderAccount(){
    renderAccountOrders();
  }

  /* ==============
     Orders storage
     ============== */
  function ordersAll(){ return LS.get(LS.ordersKey, []); }

  /* ==============
     Routing and page logic
     ============== */
  function hideAllSections(){ document.querySelectorAll('main .section').forEach(s=> s.classList.add('hidden')); }
  function showRoute(){
    const h = (location.hash || '#home').replace('#','');
    hideAllSections();
    if(h === '' || h === 'home'){ document.getElementById('home').classList.remove('hidden'); }
    else if(h === 'produtos'){ document.getElementById('produtos').classList.remove('hidden'); UI.renderAllProducts && UI.renderAllProducts(); }
    else if(h === 'carrinho'){ document.getElementById('carrinho').classList.remove('hidden'); renderCartTable(); UI.updateCart(); }
    else if(h === 'checkout'){ document.getElementById('checkout').classList.remove('hidden'); renderCheckoutSummary(); }
    else if(h === 'conta'){ document.getElementById('conta').classList.remove('hidden'); renderAccount(); }
    else {
      // category pages
      const catMap = {carros:'Carros',motos:'Motorizadas',telefones:'Telefones',eletronicos:'Eletronicos',masculino:'Masculino',feminino:'Feminino',infantil:'Infantil',servicos:'Servicos',marketing:'Marketing'};
      if(catMap[h]){
        document.getElementById(h).classList.remove('hidden');
        renderCategoryPage(catMap[h], 'cat-'+h);
      } else {
        document.getElementById('home').classList.remove('hidden');
      }
    }
    // nav highlight
    document.querySelectorAll('.nav a').forEach(a=>{ const href = (a.getAttribute('href')||'').replace('#','') || 'home'; a.classList.toggle('active', href === (location.hash.replace('#','')||'home')); });
  }

  window.addEventListener('hashchange', showRoute);

  /* ==============
     Bind events and init UI
     ============== */
  document.getElementById('filter-select').addEventListener('change', (e)=> renderAllProducts(e.target.value));
  document.getElementById('search-btn').addEventListener('click', ()=>{
    const q = (document.getElementById('search-input').value||'').trim().toLowerCase();
    if(!q){ location.hash='produtos'; showRoute(); return; }
    const list = PRODUCTS.filter(p=> p.name.toLowerCase().includes(q) || p.desc.toLowerCase().includes(q) || p.category.toLowerCase().includes(q));
    document.getElementById('produtos').classList.remove('hidden');
    document.getElementById('home').classList.add('hidden');
    document.getElementById('all-products').innerHTML = list.map(renderProductCard).join('');
    bindProductActions(document.getElementById('all-products'));
  });

  document.getElementById('btn-clear').addEventListener('click', ()=>{ cartSave([]); renderCartTable(); UI.updateCart(); UI.toast('Carrinho limpo'); });
  document.getElementById('btn-checkout').addEventListener('click', ()=>{
    const sess = getSession();
    if(!sess){ openAuthModal(); UI.toast('Fa√ßa login ou continue como convidado para finalizar a compra.'); return; }
    location.hash = 'checkout'; showRoute();
  });

  // account modal button
  document.getElementById('btn-account').addEventListener('click', (e)=>{ const sess = getSession(); if(sess){ location.hash='conta'; showRoute(); } else openAuthModal(); });

  // auth modal close on backdrop click
  document.getElementById('auth-modal').addEventListener('click', (e)=>{ if(e.target === e.currentTarget) closeAuthModal(); });

  // init
  function init(){
    // render initial sections
    renderSlider();
    renderCategories();
    renderAllProducts('all');
    renderCartTable();
    UI.updateCart();
    UI.updateAccountUI();
    // set year
    document.getElementById('year').textContent = new Date().getFullYear();
    // route
    showRoute();
    // pre-render categories
    ['carros','motos','telefones','eletronicos','masculino','feminino','infantil','servicos','marketing'].forEach(k=>{
      const catName = {carros:'Carros',motos:'Motorizadas',telefones:'Telefones',eletronicos:'Eletronicos',masculino:'Masculino',feminino:'Feminino',infantil:'Infantil',servicos:'Servicos',marketing:'Marketing'}[k];
      renderCategoryPage(catName, 'cat-'+k);
    });
  }

  // DOMContentLoaded
  document.addEventListener('DOMContentLoaded', init);
  </script>
</body>
</html>




