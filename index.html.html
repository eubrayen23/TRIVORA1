<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Trivora ‚Äî E-commerce completo</title>
  <meta name="description" content="Trivora ‚Äî loja minimalista preto & branco com login, aprova√ß√£o por email, carrinho, checkout e categorias." />
  <style>
    /* ==========================
       TRIVORA - Estilo completo
       Preto & Branco minimalista
       ========================== */
    :root{
      --bg:#fff; --fg:#0b0b0b; --muted:#6e6e6e; --card:#fff;
      --accent:#000; --soft:#f7f7f7; --radius:14px; --maxw:1200px;
      --glass: rgba(0,0,0,0.04);
      --transition: 220ms cubic-bezier(.2,.9,.3,1);
    }
    *{box-sizing:border-box}
    html,body{height:100%;margin:0;font-family:Inter,system-ui,-apple-system,"Segoe UI",Roboto,Helvetica,Arial;color:var(--fg);background:var(--bg);-webkit-font-smoothing:antialiased}
    a{color:inherit;text-decoration:none}
    img{max-width:100%;display:block}

    .container{max-width:var(--maxw);margin:0 auto;padding:0 20px}

    /* header */
    header{position:sticky;top:0;z-index:1200;background:#000;color:#fff;border-bottom:1px solid rgba(255,255,255,0.03);backdrop-filter:blur(4px)}
    .header-inner{display:flex;align-items:center;justify-content:space-between;gap:12px;padding:12px 0}
    .brand{font-weight:900;letter-spacing:2px;font-size:1.5rem}
    .nav{display:flex;gap:10px;align-items:center}
    .nav a{padding:8px 10px;border-radius:8px}
    .nav a.active,.nav a:hover{background:rgba(255,255,255,0.06)}
    .search{display:flex;align-items:center;background:#101010;padding:6px;border-radius:10px}
    .search input{border:0;background:transparent;color:#fff;outline:none;padding:8px 10px;min-width:140px}
    .search button{border:0;background:transparent;color:#fff;padding:8px 10px;cursor:pointer}
    .minicart{display:flex;align-items:center;gap:8px;padding:6px 10px;border-radius:12px;background:#fff;color:#000;font-weight:700}

    /* banner / slider */
    .banner{margin:18px 0;border-radius:var(--radius);overflow:hidden;background:#111;color:#fff}
    .slides{min-height:320px;position:relative}
    .slide{position:absolute;inset:0;display:none;padding:32px;align-items:center;justify-content:center}
    .slide.active{display:flex;animation:fadeUp .5s ease}
    @keyframes fadeUp{from{opacity:0;transform:translateY(8px)}to{opacity:1;transform:none}}
    .slide h1{font-size:2.1rem;margin:0 0 8px}
    .slide p{color:#d1d1d1;margin:0}

    .dots{position:absolute;left:50%;transform:translateX(-50%);bottom:12px;display:flex;gap:8px}
    .dot{width:10px;height:10px;border-radius:999px;background:rgba(255,255,255,0.2);cursor:pointer}
    .dot.active{background:#fff}

    /* categories showcase */
    .categories{display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:18px;margin:24px 0}
    .cat{border-radius:12px;border:1px solid #eee;overflow:hidden;background:var(--card);display:flex;flex-direction:column;transition:transform var(--transition),box-shadow var(--transition)}
    .cat:hover{transform:translateY(-6px);box-shadow:0 18px 40px rgba(0,0,0,0.06)}
    .cat .media{height:160px;overflow:hidden}
    .cat .media img{width:100%;height:100%;object-fit:cover;transition:transform .35s}
    .cat:hover .media img{transform:scale(1.05)}
    .cat .body{padding:12px;display:flex;flex-direction:column;gap:8px;flex:1}
    .cat .body h3{margin:0}
    .cat .body .meta{color:var(--muted);font-size:.95rem}
    .cat .body .group{margin-top:auto;display:flex;gap:8px}

    /* product grid & cards */
    .cards{display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:16px}
    .card{border-radius:12px;border:1px solid #eee;background:#fff;overflow:hidden;display:flex;flex-direction:column;transition:transform var(--transition);position:relative}
    .card:hover{transform:translateY(-6px)}
    .thumb{height:180px;overflow:hidden}
    .thumb img{width:100%;height:100%;object-fit:cover;transition:transform .35s}
    .card:hover .thumb img{transform:scale(1.05)}
    .info{padding:12px;display:flex;flex-direction:column;gap:8px;flex:1}
    .price{font-weight:800}
    .actions{display:flex;gap:8px;padding:12px}
    .btn{flex:1;padding:10px;border-radius:10px;border:0;background:#000;color:#fff;cursor:pointer;font-weight:700}
    .btn.alt{background:#f0f0f0;color:#000;border:1px solid #ddd}

    /* cart table / forms */
    .table{width:100%;border-collapse:collapse}
    .table th,.table td{padding:12px;border-bottom:1px solid #eee;text-align:left}
    .form{display:grid;gap:12px}
    .form input,.form select,.form textarea{padding:10px;border-radius:8px;border:1px solid #ddd}
    .small{font-size:.9rem;color:var(--muted)}

    /* footer bottom bar (common) */
    .footer{margin-top:30px;background:#000;color:#fff;padding:18px 0;text-align:center}
    .footerbar{position:fixed;left:0;right:0;bottom:0;background:#0a0a0a;color:#fff;padding:8px 12px;border-top:1px solid rgba(255,255,255,0.03);display:flex;align-items:center;justify-content:center;gap:18px;z-index:1400}
    .footerbar a{color:#fff;padding:8px;border-radius:8px}

    /* modals */
    .modal-backdrop{position:fixed;inset:0;background:rgba(0,0,0,0.6);display:flex;align-items:center;justify-content:center;z-index:2000}
    .modal{background:#fff;border-radius:12px;max-width:720px;width:100%;padding:18px;box-shadow:0 20px 60px rgba(0,0,0,0.12)}
    .modal h3{margin:0 0 12px}

    /* notifications small */
    .toast{position:fixed;left:50%;top:18px;transform:translateX(-50%);background:#fff;padding:10px 14px;border-radius:10px;box-shadow:0 12px 40px rgba(0,0,0,.12);z-index:2600}

    /* responsive */
    @media (max-width:900px){
      .search input{min-width:80px}
      .header-inner{padding:10px}
      .slide h1{font-size:1.4rem}
      .footerbar{padding:10px;gap:10px}
    }
  </style>
</head>
<body>
  <!-- Header -->
  <header>
    <div class="container header-inner">
      <div style="display:flex;align-items:center;gap:16px">
        <a class="brand" href="#home" data-link>TRIVORA</a>
        <nav class="nav" aria-label="menu superior">
          <a href="#home" class="nav-link" data-link>Home</a>
          <a href="#produtos" class="nav-link" data-link>Produtos</a>
        </nav>
      </div>

      <div style="display:flex;align-items:center;gap:12px">
        <div class="search" role="search">
          <input id="search" placeholder="Buscar produtos..." aria-label="Buscar produtos">
          <button id="btn-search">üîç</button>
        </div>
        <a class="minicart" href="#carrinho" data-link aria-label="Carrinho">üõí <span id="cart-count">0</span></a>
        <button id="btn-open-login" class="btn alt" style="padding:8px 10px">Entrar / Registar</button>
      </div>
    </div>
  </header>

  <!-- Main content -->
  <main class="container" id="app">
    <!-- Banner / Slider -->
    <section id="home" class="section">
      <div class="banner" role="region" aria-label="promo√ß√µes">
        <div class="slides">
          <div class="slide active" data-i="0">
            <div style="text-align:center">
              <h1>Trivora ‚Äî Mobilidade & Tecnologia</h1>
              <p class="small">Destaques em Carros e Motorizadas. Minimalista, elegante, direto.</p>
            </div>
          </div>
          <div class="slide" data-i="1">
            <div style="text-align:center">
              <h1>Promo√ß√µes semanais</h1>
              <p class="small">Ofertas selecionadas por tempo limitado.</p>
            </div>
          </div>
        </div>
        <div class="dots" id="dots"></div>
      </div>

      <!-- categories showcase -->
      <section aria-label="categorias" style="margin-top:20px">
        <h2 style="margin:0 0 8px">Categorias</h2>
        <p class="small" style="margin:0 0 12px">Clique numa categoria para ver todos os produtos dela. Cada bloco mostra um produto representativo.</p>
        <div class="categories" id="categories"></div>
      </section>
    </section>

    <!-- Produtos (all) -->
    <section id="produtos" class="section hidden">
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:12px">
        <h1>Produtos</h1>
        <div>
          <label class="small">Filtrar: </label>
          <select id="filter">
            <option value="all">Todas</option>
            <option value="Carros">Carros</option>
            <option value="Motorizadas">Motorizadas</option>
            <option value="Telefones">Telefones</option>
            <option value="Eletronicos">Eletr√¥nicos</option>
            <option value="Masculino">Masculino</option>
            <option value="Feminino">Feminino</option>
            <option value="Infantil">Infantil</option>
            <option value="Beleza">Beleza</option>
            <option value="Servicos">Servi√ßos</option>
            <option value="Marketing">Marketing</option>
          </select>
        </div>
      </div>
      <div id="all-products" class="cards"></div>
    </section>

    <!-- Category pages (hidden by default) -->
    <section id="carros" class="section hidden"><h1>Carros</h1><div class="cards" id="cat-carros"></div></section>
    <section id="motos" class="section hidden"><h1>Motorizadas</h1><div class="cards" id="cat-motos"></div></section>
    <section id="telefones" class="section hidden"><h1>Telefones</h1><div class="cards" id="cat-telefones"></div></section>
    <section id="eletronicos" class="section hidden"><h1>Eletr√¥nicos</h1><div class="cards" id="cat-eletronicos"></div></section>
    <section id="masculino" class="section hidden"><h1>Moda Masculina</h1><div class="cards" id="cat-masculino"></div></section>
    <section id="feminino" class="section hidden"><h1>Moda Feminina & Beleza</h1><div class="cards" id="cat-feminino"></div></section>
    <section id="infantil" class="section hidden"><h1>Moda Infantil</h1><div class="cards" id="cat-infantil"></div></section>
    <section id="servicos" class="section hidden"><h1>Servi√ßos Online</h1><div class="cards" id="cat-servicos"></div></section>
    <section id="marketing" class="section hidden"><h1>Espa√ßo de Marketing</h1><div class="cards" id="cat-marketing"></div></section>

    <!-- Cart -->
    <section id="carrinho" class="section hidden">
      <h1>Seu Carrinho</h1>
      <table class="table" id="cart-table">
        <thead><tr><th>Produto</th><th>Pre√ßo</th><th>Qtd</th><th>Subtotal</th><th></th></tr></thead>
        <tbody></tbody>
      </table>
      <div style="display:flex;justify-content:space-between;align-items:center;margin-top:12px">
        <div>Total: <strong id="cart-total">Kz 0</strong></div>
        <div style="display:flex;gap:8px">
          <button class="btn" id="btn-go-checkout">Finalizar compra</button>
          <button class="btn alt" id="btn-clear-cart">Limpar</button>
        </div>
      </div>
    </section>

    <!-- Checkout -->
    <section id="checkout" class="section hidden">
      <h1>Checkout</h1>
      <div style="display:grid;grid-template-columns:1fr 320px;gap:18px">
        <form id="checkout-form" class="form">
          <input name="name" placeholder="Nome completo" required />
          <input name="email" type="email" placeholder="Email" required />
          <input name="address" placeholder="Endere√ßo completo" required />
          <input name="phone" placeholder="Telefone" required />
          <select name="payment" required>
            <option value="">Selecionar m√©todo</option>
            <option>Multicaixa</option>
            <option>Unitel Money</option>
            <option>PayPal</option>
            <option>Stripe</option>
          </select>
          <textarea name="notes" placeholder="Observa√ß√µes (opcional)"></textarea>
          <button class="btn" type="submit">Confirmar pedido (simulado)</button>
        </form>

        <aside style="border:1px solid #eee;border-radius:12px;padding:12px">
          <h3>Resumo</h3>
          <table class="table" id="summary-table"><thead><tr><th>Produto</th><th>Qtd</th><th>Total</th></tr></thead><tbody></tbody><tfoot><tr><td colspan="2">Total</td><td id="summary-total">Kz 0</td></tr></tfoot></table>
        </aside>
      </div>
    </section>

    <!-- Account -->
    <section id="conta" class="section hidden">
      <h1>Minha Conta</h1>
      <div id="account-area"></div>
    </section>

  </main>

  <!-- footer -->
  <footer class="footer">
    ¬© <span id="year"></span> Trivora ‚Äî Mobilidade, Tecnologia & Estilo
  </footer>

  <!-- bottom footerbar (common) -->
  <div class="footerbar" role="navigation" aria-label="barra inferior">
    <a href="#home" data-link>Home</a>
    <a href="#produtos" data-link>Produtos</a>
    <a href="#carrinho" data-link>Carrinho</a>
    <a href="#conta" data-link>Conta</a>
  </div>

  <!-- Login/Register Modal -->
  <div id="modal-auth" class="modal-backdrop hidden" role="dialog" aria-modal="true">
    <div class="modal" role="document">
      <h3 id="auth-title">Entrar / Registrar</h3>
      <div style="display:flex;gap:12px;align-items:flex-start;flex-wrap:wrap">
        <div style="flex:1;min-width:260px">
          <h4>Entrar</h4>
          <form id="form-login" class="form">
            <input name="email" type="email" placeholder="Email" required />
            <input name="password" type="password" placeholder="Senha" required />
            <div style="display:flex;gap:8px">
              <button class="btn" type="submit">Entrar</button>
              <button class="btn alt" type="button" id="btn-close-auth">Fechar</button>
            </div>
          </form>
        </div>
        <div style="flex:1;min-width:260px;border-left:1px solid #eee;padding-left:12px">
          <h4>Registrar</h4>
          <form id="form-register" class="form">
            <input name="name" placeholder="Nome completo" required />
            <input name="email" type="email" placeholder="Email" required />
            <input name="phone" placeholder="Telefone" />
            <input name="password" type="password" placeholder="Senha" required />
            <div style="display:flex;gap:8px">
              <button class="btn" type="submit">Registar</button>
            </div>
            <p class="small muted" style="margin-top:6px">Ap√≥s registo a conta fica em <strong>pendente</strong>. Um email ser√° enviado √† Trivora para aprova√ß√£o manual.</p>
          </form>
        </div>
      </div>
    </div>
  </div>

  <!-- Simple toast placeholder -->
  <div id="toast-placeholder" style="position:fixed;left:50%;top:16px;transform:translateX(-50%);z-index:2800"></div>

  <!-- ============================
       JAVASCRIPT (completo)
       - substitui as placeholders do Firebase e EmailJS por tuas chaves
       - se n√£o preencheres, o sistema usa fallback localStorage (para testes)
       ============================ -->
  <script>
  /**************************************************************************
   *  CONFIGURA√á√ïES IMPORTANTES
   *
   *  1) Para ter aprova√ß√£o real por email e persist√™ncia remota, cria um
   *     projeto no Firebase e substitui abaixo os valores de firebaseConfig.
   *  2) Para enviar email autom√°tico ao registar, podes usar EmailJS (sem
   *     servidor) ‚Äî substitui SERVICE_ID, TEMPLATE_ID, USER_ID.
   *
   *  Se n√£o preencheres, o sistema funciona localmente (localStorage) para
   *  desenvolvimento e testes.
   **************************************************************************/

  // --- FIREBASE: coloque suas credenciais aqui (opcional) ---
  const FIREBASE_ENABLED = false; // trocar para true se configurar
  const firebaseConfig = {
    apiKey: "YOUR_API_KEY",
    authDomain: "YOUR_AUTH_DOMAIN",
    projectId: "YOUR_PROJECT_ID",
    // ... resto da config
  };

  // --- EMAILJS: envie email para equipa nas registos (opcional) ---
  const EMAILJS_ENABLED = false; // mudar para true se configurar
  const EMAILJS_SERVICE = "YOUR_EMAILJS_SERVICE";
  const EMAILJS_TEMPLATE = "YOUR_EMAILJS_TEMPLATE";
  const EMAILJS_USER = "YOUR_EMAILJS_USER";

  /**************************************************************************
   *  LIBS (carregamento din√¢mico de Firebase / EmailJS se configurados)
   **************************************************************************/
  async function loadFirebase() {
    if(!FIREBASE_ENABLED) return null;
    // carregamento din√¢mico do SDK (v10 modular)
    await import('https://www.gstatic.com/firebasejs/10.14.1/firebase-app.js');
    await import('https://www.gstatic.com/firebasejs/10.14.1/firebase-firestore.js');
    // note: inlined imports above may or may not be cached by browser; 
    // we'll access global firebase after import in this environment
    return window.firebase;
  }

  async function loadEmailJS(){
    if(!EMAILJS_ENABLED) return null;
    // EmailJS CDN
    if(!window.emailjs){
      await new Promise((res,rej)=>{
        const s=document.createElement('script');
        s.src='https://cdn.jsdelivr.net/npm/emailjs-com@2/dist/email.min.js';
        s.onload=res; s.onerror=rej; document.head.appendChild(s);
      });
      if(window.emailjs && EMAILJS_USER) window.emailjs.init(EMAILJS_USER);
    }
    return window.emailjs;
  }

  /**************************************************************************
   *  SIMPLE STORAGE HELPERS (local)
   **************************************************************************/
  const store = {
    get(k, fallback=null){ try{ const v = localStorage.getItem(k); return v ? JSON.parse(v) : fallback; } catch(e){ return fallback; } },
    set(k,v){ try{ localStorage.setItem(k, JSON.stringify(v)); }catch(e){} },
    remove(k){ try{ localStorage.removeItem(k); }catch(e){} }
  };

  /**************************************************************************
   *  DATA: produtos (amplo conjunto)
   **************************************************************************/
  const PRODUCTS = [
    // ... (representativo; expandi de prop√≥sito)
    {id:'car-tesla', category:'Carros', name:'Tesla Model 3', price:9500000, img:'https://source.unsplash.com/800x600/?tesla,car', desc:'El√©trico, autonomia e tecnologia.'},
    {id:'car-mercedes', category:'Carros', name:'Mercedes C200', price:7800000, img:'https://source.unsplash.com/800x600/?mercedes,car', desc:'Luxo e conforto.'},
    {id:'moto-yamaha', category:'Motorizadas', name:'Yamaha R1', price:3200000, img:'https://source.unsplash.com/800x600/?yamaha,motorcycle', desc:'Esportiva de alta performance.'},
    {id:'moto-honda', category:'Motorizadas', name:'Honda CBR600', price:2800000, img:'https://source.unsplash.com/800x600/?honda,motorcycle', desc:'Pot√™ncia e controle.'},
    {id:'tel-iphone', category:'Telefones', name:'iPhone 15 Pro', price:850000, img:'https://source.unsplash.com/800x600/?iphone,phone', desc:'C√¢mera top e performance.'},
    {id:'tel-samsung', category:'Telefones', name:'Samsung Galaxy S24', price:620000, img:'https://source.unsplash.com/800x600/?samsung,phone', desc:'Tela AMOLED brilhante.'},
    {id:'ele-tv', category:'Eletronicos', name:'Smart TV 55"', price:300000, img:'https://source.unsplash.com/800x600/?tv,television', desc:'4K HDR e apps integrados.'},
    {id:'ele-lap', category:'Eletronicos', name:'Notebook Ultrabook', price:540000, img:'https://source.unsplash.com/800x600/?laptop,notebook', desc:'Leve e potente.'},
    {id:'mas-tenis', category:'Masculino', name:'T√™nis Running', price:45000, img:'https://source.unsplash.com/800x600/?mens-shoes', desc:'Conforto para corridas.'},
    {id:'mas-jaqueta', category:'Masculino', name:'Jaqueta Bomber', price:46000, img:'https://source.unsplash.com/800x600/?mens-jacket', desc:'Estilo urbano.'},
    {id:'fem-vestido', category:'Feminino', name:'Vestido Floral', price:25000, img:'https://source.unsplash.com/800x600/?dress,women', desc:'Leve e elegante.'},
    {id:'fem-bolsa', category:'Feminino', name:'Bolsa Tiracolo', price:52000, img:'https://source.unsplash.com/800x600/?womens-bag', desc:'Acabamento premium.'},
    {id:'bez-kit', category:'Beleza', name:'Kit Maquiagem', price:15000, img:'https://source.unsplash.com/800x600/?makeup,cosmetics', desc:'Completo para o dia a dia.'},
    {id:'inf-conj', category:'Infantil', name:'Conjunto Infantil', price:15000, img:'https://source.unsplash.com/800x600/?kids,clothes', desc:'Conforto para os pequenos.'},
    {id:'srv-logo', category:'Servicos', name:'Design de Logo', price:20000, img:'https://source.unsplash.com/800x600/?logo,design', desc:'Identidade visual profissional.'},
    {id:'mkt-anuncio', category:'Marketing', name:'An√∫ncio em destaque', price:10000, img:'https://source.unsplash.com/800x600/?marketing,advertising', desc:'Promova sua marca.'}
  ];

  /**************************************************************************
   *  BACKEND LAYER (optionally remote via Firebase)
   *  - If FIREBASE_ENABLED = true, functions below use Firestore.
   *  - Otherwise fallback to localStorage emulation (users/orders).
   **************************************************************************/
  let firestore = null;
  async function initBackend(){
    if(FIREBASE_ENABLED){
      // carregar Firebase dinamicamente (modular SDK)
      // Nota: para funcionar, ter√°s de incluir credenciais e permitir CORS / rules adequadas
      try{
        await loadFirebase();
        // using global firebase namespace loaded by import; create app and firestore
        if(window.firebase && window.firebase.initializeApp){
          window.firebase.initializeApp(firebaseConfig);
          firestore = window.firebase.firestore();
          console.log('Firebase iniciado');
        } else {
          console.warn('SDK Firebase n√£o encontrado - fallback para local');
        }
      }catch(err){
        console.warn('Falha ao iniciar Firebase (fallback local):',err);
      }
    }
    // carregar EmailJS se estiver configurado
    if(EMAILJS_ENABLED){
      try{ await loadEmailJS(); }catch(e){ console.warn('EmailJS load falhou', e); }
    }
  }

  /* ==== Users / registration logic (remote if possible) ==== */
  // Data model:
  // users: { id, name, email, phone, password (hashed? currently plain for demo), status: 'pending'|'active'|'rejected', createdAt }
  async function createUser(user){
    // user: {name,email,phone,password}
    if(firestore){
      // Firestore write
      const doc = await firestore.collection('users').add({...user, status:'pending', createdAt: new Date().toISOString()});
      return {ok:true, id: doc.id, remote:true};
    } else {
      // local fallback
      const users = store.get('trivora_users', []);
      if(users.some(u=>u.email === user.email)) return {ok:false, msg:'Email j√° registado'};
      user.id = 'u_' + Date.now();
      user.status = 'pending';
      user.createdAt = new Date().toISOString();
      users.push(user);
      store.set('trivora_users', users);
      return {ok:true, id: user.id, remote:false};
    }
  }

  async function getUserByEmail(email){
    if(firestore){
      const q = await firestore.collection('users').where('email','==',email).get();
      if(!q.empty) return {ok:true, data: q.docs[0].data(), id:q.docs[0].id};
      return {ok:false};
    } else {
      const users = store.get('trivora_users', []);
      const u = users.find(x=>x.email === email);
      return u ? {ok:true, data:u, id:u.id} : {ok:false};
    }
  }

  async function updateUserStatus(id, status){
    if(firestore){
      await firestore.collection('users').doc(id).update({status});
      return {ok:true};
    } else {
      const users = store.get('trivora_users', []);
      const u = users.find(x=>x.id===id);
      if(u){ u.status = status; store.set('trivora_users', users); return {ok:true}; }
      return {ok:false};
    }
  }

  /**************************************************************************
   *  EMAIL SENDING (notify company when new registration)
   *  - If EmailJS enabled, will send using emailjs.
   *  - Otherwise fallback: copy data to `pending_emails` in localStorage (for admin reading).
   **************************************************************************/
  async function notifyCompanyNewRegistration(user){
    if(EMAILJS_ENABLED && window.emailjs){
      try{
        await window.emailjs.send(EMAILJS_SERVICE, EMAILJS_TEMPLATE, {
          user_name: user.name,
          user_email: user.email,
          user_phone: user.phone || '',
          message: `Novo registo Trivora - email: ${user.email}`
        });
        return {ok:true, sent:true};
      }catch(e){
        console.warn('EmailJS error',e);
        // fallback to storing
      }
    }
    // fallback local: keep list of pending notifications
    const list = store.get('trivora_pending_emails', []);
    list.push({id: 'mail_' + Date.now(), user, createdAt: new Date().toISOString()});
    store.set('trivora_pending_emails', list);
    return {ok:true, sent:false};
  }

  /**************************************************************************
   *  AUTH: register / login using backend or local
   **************************************************************************/
  async function registerUser(payload){
    // payload: {name,email,phone,password}
    const exist = await getUserByEmail(payload.email);
    if(exist.ok) return {ok:false, msg:'Email j√° usado'};
    const res = await createUser(payload);
    if(!res.ok) return res;
    // notify company
    await notifyCompanyNewRegistration(payload);
    return {ok:true, id:res.id};
  }

  async function loginUser(email,password){
    const res = await getUserByEmail(email);
    if(!res.ok) return {ok:false, msg:'Utilizador n√£o encontrado'};
    const u = res.data;
    if(u.password !== password) return {ok:false, msg:'Senha inv√°lida'};
    if(u.status !== 'active') return {ok:false, msg:`Conta ${u.status}. Aguarde aprova√ß√£o.`};
    // create session token (simple)
    const session = {id:res.id, name:u.name, email:u.email};
    store.set('trivora_session', session);
    return {ok:true, session};
  }

  function logout(){
    store.remove('trivora_session');
  }

  function currentSession(){ return store.get('trivora_session', null); }

  /**************************************************************************
   *  CART (client-side localStorage)
   **************************************************************************/
  const CART_KEY = 'trivora_cart_v1';
  function cartAll(){ return store.get(CART_KEY, []); }
  function cartSave(items){ store.set(CART_KEY, items); UI.updateCart(); }
  function cartAdd(id, qty=1){
    const items = cartAll();
    const it = items.find(x=>x.id===id);
    if(it) it.qty += qty; else items.push({id, qty});
    cartSave(items);
    UI.toast('Adicionado ao carrinho');
  }
  function cartRemove(id){
    cartSave(cartAll().filter(x=>x.id !== id));
  }
  function cartSetQty(id, qty){
    const items = cartAll(); const it = items.find(x=>x.id===id);
    if(it){ it.qty = Math.max(1, qty); cartSave(items); }
  }
  function cartClear(){ cartSave([]); }

  /**************************************************************************
   *  ORDERS (local only demo)
   **************************************************************************/
  function createOrder(data){
    const orders = store.get('trivora_orders', []);
    const o = {id:'ORD-'+Date.now(), ...data, createdAt: new Date().toISOString()};
    orders.push(o); store.set('trivora_orders', orders);
    return o;
  }

  /**************************************************************************
   *  UI Rendering & bindings
   **************************************************************************/
  const UI = {
    toast(msg, ms=1600){
      const p = document.getElementById('toast-placeholder'); if(!p) return;
      const el = document.createElement('div'); el.className='toast'; el.textContent=msg;
      p.appendChild(el); setTimeout(()=> el.remove(), ms);
    },
    updateCart(){
      const cnt = cartAll().reduce((n,i)=>n+i.qty,0) || 0;
      document.getElementById('cart-count').textContent = cnt;
      // update cart total if visible
      const total = cartAll().reduce((s,i)=>{ const p = PRODUCTS.find(x=>x.id===i.id); return s + ((p?.price||0) * i.qty); },0);
      const elTotal = document.getElementById('cart-total'); if(elTotal) elTotal.textContent = formatKz(total);
    },
    renderCategories(){
      const cats = ['Carros','Motorizadas','Telefones','Eletronicos','Masculino','Feminino','Infantil','Servicos','Marketing'];
      const container = document.getElementById('categories');
      container.innerHTML = cats.map(cat=>{
        const rep = PRODUCTS.find(p=>p.category === cat) || {name:cat, img:'https://source.unsplash.com/900x500/?'+encodeURIComponent(cat)};
        return `<article class="cat" data-cat="${cat}">
          <div class="media"><img src="${rep.img}" alt="${cat}"></div>
          <div class="body">
            <h3>${cat}</h3>
            <div class="meta">${rep.name} ‚Äî <span class="small muted">${rep.desc}</span></div>
            <div class="group">
              <a class="btn alt" href="#${slug(cat)}" data-link>Ver todos</a>
              <button class="btn" data-add="${rep.id}">Adicionar</button>
            </div>
          </div>
        </article>`;
      }).join('');
      // bind category buttons
      container.querySelectorAll('[data-add]').forEach(b=> b.addEventListener('click',(e)=>{ const id=e.currentTarget.dataset.add; cartAdd(id); renderCartTable(); }));
    },
    renderProductCard(p){
      return `<article class="card" data-id="${p.id}">
        <div class="thumb"><img src="${p.img}" alt="${p.name}"></div>
        <div class="info">
          <div><strong>${p.name}</strong></div>
          <div class="price">${formatKz(p.price)}</div>
          <div class="small muted">${p.category}</div>
          <p class="small">${p.desc}</p>
        </div>
        <div class="actions">
          <button class="btn" data-add="${p.id}">Adicionar</button>
          <button class="btn alt" data-view="${p.id}">Ver</button>
        </div>
      </article>`;
    },
    renderCategoryPage(cat, selectorId){
      const node = document.getElementById(selectorId);
      if(!node) return;
      const list = PRODUCTS.filter(x=>x.category === cat);
      node.innerHTML = list.map(p => UI.renderProductCard(p)).join('');
      bindProductButtons(node);
    },
    renderAllProducts(filter='all'){
      const root = document.getElementById('all-products');
      let list = PRODUCTS.slice();
      if(filter && filter !== 'all') list = list.filter(p=>p.category === filter);
      root.innerHTML = list.map(p=> UI.renderProductCard(p)).join('');
      bindProductButtons(root);
    },
    renderCartTable(){
      const tbody = document.querySelector('#cart-table tbody');
      if(!tbody) return;
      const items = cartAll();
      if(items.length === 0){
        tbody.innerHTML = `<tr><td colspan="5" class="small muted">Carrinho vazio</td></tr>`;
        return;
      }
      tbody.innerHTML = items.map(it=>{
        const p = PRODUCTS.find(x=>x.id === it.id) || {name:'-','price':0};
        return `<tr>
          <td>${p.name}</td>
          <td>${formatKz(p.price)}</td>
          <td><input type="number" min="1" value="${it.qty}" data-id="${it.id}" class="qty" style="width:76px;padding:6px;border-radius:6px;border:1px solid #ddd"></td>
          <td>${formatKz((p.price||0) * it.qty)}</td>
          <td><button class="btn alt" data-remove="${it.id}">Remover</button></td>
        </tr>`;
      }).join('');
      // bind qty and remove
      tbody.querySelectorAll('.qty').forEach(i=> i.addEventListener('input', (e)=>{ const id=e.currentTarget.dataset.id; cartSetQty(id, parseInt(e.currentTarget.value||1,10)); UI.renderCartTable(); UI.updateCart(); }));
      tbody.querySelectorAll('[data-remove]').forEach(b=> b.addEventListener('click', (e)=>{ cartRemove(e.currentTarget.dataset.remove); UI.renderCartTable(); UI.updateCart(); }));
    },
    updateAuthUI(){
      const session = currentSession();
      const btn = document.getElementById('btn-open-login');
      if(session){ btn.textContent = session.name.split(' ')[0]; btn.classList.add('alt'); } else { btn.textContent = 'Entrar / Registar'; btn.classList.remove('alt'); }
    },
    toast(msg){ UI.toast(msg); }
  };

  /* helpers */
  function formatKz(v){ return 'Kz ' + Number(v).toLocaleString('pt-PT'); }
  function slug(cat){ return cat.toLowerCase().replace(/\s+/g,''); }

  /* bind add / view buttons within a container */
  function bindProductButtons(root){
    root.querySelectorAll('[data-add]').forEach(b=>{ b.removeEventListener('click', btnAddHandler); b.addEventListener('click', btnAddHandler); });
    root.querySelectorAll('[data-view]').forEach(b=>{ b.removeEventListener('click', btnViewHandler); b.addEventListener('click', btnViewHandler); });
  }
  function btnAddHandler(e){ const id = e.currentTarget.dataset.add; cartAdd(id); UI.renderCartTable(); UI.updateCart(); }
  function btnViewHandler(e){ const id = e.currentTarget.dataset.view; const p = PRODUCTS.find(x=>x.id===id); if(p) quickView(p); }

  /* quick view modal */
  function quickView(p){
    const md = document.createElement('div'); md.className='modal-backdrop'; md.style.zIndex=5000;
    md.innerHTML = `<div class="modal">
      <div style="display:flex;gap:12px;flex-wrap:wrap">
        <div style="flex:1;min-width:240px"><img src="${p.img}" alt="${p.name}" style="width:100%;height:320px;object-fit:cover;border-radius:8px"></div>
        <div style="flex:1;min-width:240px">
          <h3>${p.name}</h3>
          <div style="font-weight:800;margin:8px 0">${formatKz(p.price)}</div>
          <p class="small muted">${p.category}</p>
          <p style="margin-top:8px">${p.desc}</p>
          <div style="margin-top:12px;display:flex;gap:8px">
            <button class="btn" id="qv-add">Adicionar</button>
            <button class="btn alt" id="qv-close">Fechar</button>
          </div>
        </div>
      </div>
    </div>`;
    document.body.appendChild(md);
    md.querySelector('#qv-close').addEventListener('click', ()=> md.remove());
    md.querySelector('#qv-add').addEventListener('click', ()=>{ cartAdd(p.id); UI.renderCartTable(); UI.updateCart(); md.remove(); });
  }

  /**************************************************************************
   *  AUTH UI bindings (login/register modal)
   **************************************************************************/
  function openAuthModal(){ document.getElementById('modal-auth').classList.remove('hidden'); }
  function closeAuthModal(){ document.getElementById('modal-auth').classList.add('hidden'); }

  document.getElementById('btn-open-login').addEventListener('click', openAuthModal);
  document.getElementById('btn-close-auth').addEventListener('click', closeAuthModal);

  document.getElementById('form-register').addEventListener('submit', async function(e){
    e.preventDefault();
    const fd = new FormData(e.target); const data = Object.fromEntries(fd.entries());
    // basic validation
    if(!data.email || !data.password || !data.name) return UI.toast('Preencha o formul√°rio corretamente');
    const res = await registerUser(data);
    if(!res.ok) return UI.toast(res.msg || 'Erro ao registar');
    UI.toast('Registo recebido. Aguardando aprova√ß√£o.');
    e.target.reset();
    closeAuthModal();
  });

  document.getElementById('form-login').addEventListener('submit', async function(e){
    e.preventDefault();
    const fd = new FormData(e.target); const { email, password } = Object.fromEntries(fd.entries());
    const res = await loginUser(email, password);
    if(!res.ok){ UI.toast(res.msg || 'Falha ao entrar'); return; }
    UI.updateAuthUI(); UI.toast('Sess√£o iniciada'); closeAuthModal(); location.hash = 'conta'; renderAccount();
  });

  /**************************************************************************
   *  Simple account page rendering & approval admin UI
   *  - For demonstration, if admin opens /conta with local data they can
   *    approve pending users stored in localStorage.
   **************************************************************************/
  function renderAccount(){
    const area = document.getElementById('account-area');
    const session = currentSession();
    if(!session){
      area.innerHTML = `<div class="small muted">Inicia sess√£o ou regista-se para ver ou aprovar contas.</div>`;
      return;
    }
    // user area (simple)
    area.innerHTML = `<div style="display:flex;justify-content:space-between;align-items:center">
      <div><h3>Ol√°, ${session.name}</h3><div class="small muted">${session.email}</div></div>
      <div><button id="btn-logout" class="btn alt">Sair</button></div>
    </div>
    <div style="margin-top:18px">
      <h4>Pedidos (exibi√ß√£o local)</h4>
      <div id="orders-list" class="small muted"></div>
    </div>
    <div style="margin-top:18px">
      <h4>Usu√°rios pendentes (admin)</h4>
      <div id="pending-users"></div>
    </div>`;
    document.getElementById('btn-logout').addEventListener('click', ()=>{ logout(); UI.updateAuthUI(); renderAccount(); UI.toast('Terminaste sess√£o'); });
    // show orders for this email
    const orders = store.get('trivora_orders', []).filter(o => (o.customer && o.customer.email) === session.email);
    const ol = document.getElementById('orders-list');
    ol.innerHTML = orders.length ? orders.map(o=> `<div>${o.id} ‚Äî ${new Date(o.createdAt).toLocaleString()} ‚Äî ${formatKz(o.total)}</div>`).join('') : '<div class="small muted">Sem pedidos</div>';

    // pending users (local only)
    const pending = store.get('trivora_users', []).filter(u=>u.status === 'pending');
    const pu = document.getElementById('pending-users');
    if(!pending.length){ pu.innerHTML = '<div class="small muted">Nenhum usu√°rio pendente</div>'; return; }
    pu.innerHTML = pending.map(u=>`
      <div style="border:1px solid #eee;padding:8px;border-radius:8px;margin-bottom:8px;display:flex;justify-content:space-between;align-items:center">
        <div>
          <div><strong>${u.name}</strong> ‚Ä¢ <span class="small muted">${u.email}</span></div>
          <div class="small muted">${u.phone || ''}</div>
        </div>
        <div style="display:flex;gap:6px">
          <button class="btn" data-approve="${u.id}">Aprovar</button>
          <button class="btn alt" data-reject="${u.id}">Rejeitar</button>
        </div>
      </div>
    `).join('');
    // bind approve/reject
    pu.querySelectorAll('[data-approve]').forEach(b=> b.addEventListener('click', async (e)=>{
      const id = e.currentTarget.dataset.approve;
      await updateUserStatus(id, 'active');
      UI.toast('Usu√°rio aprovado');
      renderAccount();
    }));
    pu.querySelectorAll('[data-reject]').forEach(b=> b.addEventListener('click', async (e)=>{
      const id = e.currentTarget.dataset.reject;
      await updateUserStatus(id, 'rejected');
      UI.toast('Usu√°rio rejeitado');
      renderAccount();
    }));
  }

  /**************************************************************************
   *  Checkout form handling (simulated payment)
   **************************************************************************/
  document.getElementById('checkout-form').addEventListener('submit', function(e){
    e.preventDefault();
    const items = cartAll();
    if(items.length === 0){ UI.toast('Carrinho vazio'); return; }
    const fd = new FormData(e.target); const customer = Object.fromEntries(fd.entries());
    const total = items.reduce((s,i)=>{ const p = PRODUCTS.find(x=>x.id===i.id); return s + ((p?.price||0) * i.qty); }, 0);
    const order = createOrder({ items, total, customer, status: 'Pago (Simulado)' });
    cartClear(); UI.renderCartTable(); UI.updateCart();
    UI.toast('Pedido confirmado (simula√ß√£o): ' + order.id);
    location.hash = 'conta';
    renderAccount();
  });

  /**************************************************************************
   *  Routing & UI init
   **************************************************************************/
  function hideAllSections(){ document.querySelectorAll('main .section').forEach(s=> s.classList.add('hidden')); }
  function showSectionByHash(){
    const h = (location.hash || '#home').replace('#','');
    hideAllSections();
    const target = document.getElementById(h);
    if(target) target.classList.remove('hidden');
    else document.getElementById('home').classList.remove('hidden');
    // contextual renders
    if(['carros','motos','telefones','eletronicos','masculino','feminino','infantil','servicos','marketing'].includes(h)){
      const catMap = {carros:'Carros',motos:'Motorizadas',telefones:'Telefones',eletronicos:'Eletronicos',masculino:'Masculino',feminino:'Feminino',infantil:'Infantil',servicos:'Servicos',marketing:'Marketing'};
      const selector = 'cat-' + h;
      UI.renderCategoryPage(catMap[h], selector);
    }
    if(h === 'produtos'){ UI.renderAllProducts(); }
    if(h === 'carrinho'){ UI.renderCartTable(); UI.updateCart(); }
    if(h === 'checkout'){ renderCheckoutSummary(); }
    if(h === 'conta'){ renderAccount(); }
    // update nav active
    document.querySelectorAll('.nav-link').forEach(a=>{
      const href = (a.getAttribute('href')||'').replace('#','') || 'home';
      a.classList.toggle('active', href === h);
    });
  }

  function renderCheckoutSummary(){
    const tb = document.querySelector('#summary-table tbody');
    const items = cartAll();
    if(!tb) return;
    if(items.length === 0){ tb.innerHTML = '<tr><td colspan="3">Carrinho vazio</td></tr>'; document.getElementById('summary-total').textContent = 'Kz 0'; return; }
    tb.innerHTML = items.map(i=>{
      const p = PRODUCTS.find(x=>x.id===i.id);
      return `<tr><td>${p.name}</td><td>${i.qty}</td><td>${formatKz((p.price||0)*i.qty)}</td></tr>`;
    }).join('');
    const total = items.reduce((s,i)=>{ const p = PRODUCTS.find(x=>x.id===i.id); return s + ((p?.price||0) * i.qty); }, 0);
    document.getElementById('summary-total').textContent = formatKz(total);
  }

  // dot navigation for slider
  function initSlider(){
    const slides = Array.from(document.querySelectorAll('.slide'));
    const dots = document.getElementById('dots');
    dots.innerHTML = slides.map((_,i)=> `<div class="dot ${i===0?'active':''}" data-i="${i}"></div>`).join('');
    const dotEls = Array.from(dots.children);
    let idx = 0;
    const show = (i)=>{ slides.forEach((s, k)=> s.classList.toggle('active', k===i)); dotEls.forEach((d,k)=> d.classList.toggle('active', k===i)); idx = i; };
    dotEls.forEach(d=> d.addEventListener('click', ()=> show(parseInt(d.dataset.i))));
    setInterval(()=> show((idx+1) % slides.length), 5200);
  }

  // quick bind for data-link anchors
  document.addEventListener('click', (e)=>{
    const anchor = e.target.closest('[data-link]');
    if(anchor){
      const href = anchor.getAttribute('href') || '';
      if(href.startsWith('#')){ location.hash = href; e.preventDefault(); }
    }
  });

  // search
  document.getElementById('btn-search').addEventListener('click', ()=> {
    const q = document.getElementById('search').value.trim().toLowerCase();
    if(!q){ location.hash = 'produtos'; return; }
    const list = PRODUCTS.filter(p => p.name.toLowerCase().includes(q) || p.desc.toLowerCase().includes(q) || p.category.toLowerCase().includes(q));
    document.getElementById('produtos').classList.remove('hidden');
    document.getElementById('home').classList.add('hidden');
    document.getElementById('all-products').innerHTML = list.map(p=> UI.renderProductCard(p)).join('');
    bindProductButtons(document.getElementById('all-products'));
    location.hash = 'produtos';
  });

  // filter select
  document.getElementById('filter').addEventListener('change', (e)=> UI.renderAllProducts(e.target.value) );

  // cart actions
  document.getElementById('btn-clear-cart').addEventListener('click', ()=>{ cartClear(); UI.renderCartTable(); UI.updateCart(); UI.toast('Carrinho esvaziado'); });
  document.getElementById('btn-go-checkout').addEventListener('click', ()=> location.hash = 'checkout');

  // register/login modal show/hide on load
  document.addEventListener('DOMContentLoaded', async ()=>{
    // init backend (attempt to load firebase/emailjs if toggled)
    await initBackend();
    // initial UI
    UI.renderCategories();
    UI.renderAllProducts('all');
    UI.updateCart();
    UI.updateAuthUI();
    initSlider();
    renderCookieWelcome();
    // pre-render category containers
    ['carros','motos','telefones','eletronicos','masculino','feminino','infantil','servicos','marketing'].forEach(k=> UI.renderCategoryPage({Carros:'Carros'}[k] || k, 'cat-'+k));
    // routing
    window.addEventListener('hashchange', showSectionByHash);
    showSectionByHash();
  });

  /**************************************************************************
   *  Welcome modal once (localStorage)
   **************************************************************************/
  function renderCookieWelcome(){
    const seen = store.get('trivora_welcomed', false);
    if(!seen){
      // show small welcome toast instead modal to avoid blocking dev
      UI.toast('Bem-vindo √† Trivora ‚Äî Onde tecnologia e estilo se encontram', 2200);
      store.set('trivora_welcomed', true);
    }
  }

  /**************************************************************************
   *  Helper: simulate admin approval flow demonstration
   *  - Provide instructions for admin: open console and run functions,
   *    or use the /conta UI which shows pending users in local fallback.
   **************************************************************************/

  // Expose small helpers to console for admin/developer convenience
  window.TRIVORA_DEBUG = {
    PRODUCTS, store, createUser, getUserByEmail, updateUserStatus, cartAll, cartAdd, cartClear
  };

  /**************************************************************************
   *  Utility: show quick login/register helper for demo (auto-register test)
   **************************************************************************/
  // none further ‚Äî end of script
  </script>
</body>
</html>





