<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Trivora ‚Äî Marketplace Preto & Branco</title>
  <meta name="description" content="Trivora - E-commerce minimalista preto e branco. Carrinho, checkout simulado, login, categorias e vitrines.">
  <style>
  /* ===========================
     VARS & RESET
     =========================== */
  :root{
    --bg: #ffffff;
    --fg: #0b0b0b;
    --muted: #6f6f6f;
    --card: #fff;
    --accent: #000;
    --glass: rgba(0,0,0,0.04);
    --radius: 14px;
    --container: 1200px;
    --ease: cubic-bezier(.2,.9,.3,1);
  }
  *{box-sizing:border-box}
  html,body{height:100%;margin:0;font-family:Inter,ui-sans-serif,system-ui,-apple-system,"Segoe UI",Roboto,Helvetica,Arial;background:var(--bg);color:var(--fg);-webkit-font-smoothing:antialiased}
  a{text-decoration:none;color:inherit}
  img{max-width:100%;display:block}

  /* ===========================
     LAYOUT
     =========================== */
  .container{max-width:var(--container);margin:0 auto;padding:0 20px}
  header{position:sticky;top:0;z-index:1200;background:#000;color:#fff;border-bottom:1px solid rgba(255,255,255,0.04);backdrop-filter: blur(6px)}
  .header-inner{display:flex;align-items:center;justify-content:space-between;padding:12px 0;gap:12px;max-width:var(--container);margin:0 auto;padding-left:20px;padding-right:20px}
  .brand{font-weight:900;letter-spacing:2px;font-size:1.4rem}
  .nav{display:flex;gap:8px;align-items:center}
  .nav a{padding:8px 10px;border-radius:8px;opacity:.98;transition:all .22s var(--ease);color:#fff}
  .nav a:hover,.nav a.active{background:rgba(255,255,255,0.06)}
  .controls{display:flex;align-items:center;gap:12px}

  .search{display:flex;align-items:center;background:#111;padding:6px;border-radius:10px}
  .search input{border:0;background:transparent;color:#fff;padding:8px 10px;min-width:160px;outline:none}
  .search button{background:transparent;border:0;color:#fff;padding:6px;cursor:pointer}

  .minicart{display:flex;align-items:center;gap:8px;padding:6px 10px;border-radius:12px;background:#fff;color:#000;font-weight:700;cursor:pointer}
  .minicart span{font-weight:800}

  /* ===========================
     HERO / BANNER (destaque)
     =========================== */
  .hero{margin:18px 0;border-radius:var(--radius);overflow:hidden;position:relative;background:#000;color:#fff}
  .slides{min-height:320px;position:relative;display:flex;align-items:center;justify-content:center}
  .slide{position:absolute;inset:0;display:none;padding:24px;align-items:center;justify-content:center;text-align:center}
  .slide.active{display:flex;animation:bannerIn .6s var(--ease)}
  @keyframes bannerIn{from{opacity:0;transform:translateY(10px)}to{opacity:1;transform:none}}
  .slide .inner{max-width:900px;padding:34px}
  .slide h1{font-size:2.2rem;margin:0 0 8px}
  .slide p{color:#d1d1d1;margin:0 0 12px}
  .slide .cta{margin-top:12px;padding:10px 18px;border-radius:10px;background:#fff;color:#000;display:inline-block;font-weight:700}
  .hero .dots{position:absolute;left:50%;transform:translateX(-50%);bottom:12px;display:flex;gap:8px}
  .dot{width:10px;height:10px;border-radius:999px;background:rgba(255,255,255,0.18);cursor:pointer}
  .dot.active{background:#fff}

  /* ===========================
     CATEGORIES (faixa principal)
     =========================== */
  .category-bar{display:flex;gap:12px;align-items:center;overflow:auto;padding:12px 0;margin:16px 0}
  .cat-pill{flex:0 0 auto;padding:10px 14px;border-radius:999px;background:#111;color:#fff;border:1px solid rgba(255,255,255,0.04);cursor:pointer;transition:transform .22s var(--ease)}
  .cat-pill:hover{transform:translateY(-4px);box-shadow:0 8px 20px rgba(0,0,0,0.08)}
  .cat-pill.active{background:#fff;color:#000;border:1px solid rgba(0,0,0,0.06);}

  /* ===========================
     VITRINES: destaques (home) & cards
     =========================== */
  .section-title{display:flex;justify-content:space-between;align-items:center;margin:18px 0}
  .section-title h2{font-size:1.4rem}
  .section-title .see-all{color:var(--muted);font-size:.95rem}

  .cards{display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:16px;margin-bottom:22px}
  .card{background:#fff;border-radius:12px;border:1px solid #eee;overflow:hidden;display:flex;flex-direction:column;transition:transform .28s var(--ease),box-shadow .28s var(--ease)}
  .card:hover{transform:translateY(-8px);box-shadow:0 22px 44px rgba(0,0,0,0.06)}
  .card .thumb{height:180px;overflow:hidden}
  .card .thumb img{width:100%;height:100%;object-fit:cover;transition:transform .35s}
  .card:hover .thumb img{transform:scale(1.06)}
  .meta{padding:12px;display:flex;flex-direction:column;gap:8px;flex:1}
  .meta h4{margin:0;font-size:1rem}
  .meta p{margin:0;color:var(--muted);font-size:.95rem}
  .price{font-weight:800}
  .card .actions{display:flex;gap:8px;padding:12px}
  .btn{flex:1;padding:10px;border-radius:8px;border:0;background:#000;color:#fff;cursor:pointer}
  .btn.ghost{background:#f2f2f2;color:#000;border:1px solid #e6e6e6}

  /* rating */
  .rating{display:flex;align-items:center;gap:8px;font-size:.95rem;color:var(--muted)}
  .stars{color:#000;letter-spacing:2px;font-weight:700}

  /* ===========================
     PAGES: product pages (category)
     =========================== */
  .category-section{margin:32px 0}
  .category-section h3{margin-bottom:12px}

  /* ===========================
     CART TABLE
     =========================== */
  .table{width:100%;border-collapse:collapse}
  .table th,.table td{padding:10px;border-bottom:1px solid #eee;text-align:left}
  .qty-input{width:82px;padding:6px;border-radius:6px;border:1px solid #ddd}

  /* ===========================
     ACCOUNT / CHECKOUT
     =========================== */
  .form{display:grid;gap:12px}
  input,select,textarea{padding:10px;border-radius:8px;border:1px solid #ddd;font-size:14px}
  button.cta{padding:12px;border-radius:10px;border:0;background:#000;color:#fff;font-weight:700;cursor:pointer}

  /* ===========================
     MODALs / QUICKVIEW / AUTH
     =========================== */
  .modal-backdrop{position:fixed;inset:0;background:rgba(0,0,0,0.6);display:none;align-items:center;justify-content:center;z-index:2600}
  .modal{background:#fff;border-radius:12px;padding:18px;max-width:820px;width:100%;box-shadow:0 20px 60px rgba(0,0,0,0.12)}
  .modal h3{margin:0 0 8px}
  .modal .close{position:absolute;right:14px;top:12px;font-size:20px;cursor:pointer}

  /* ===========================
     FOOTER & FOOTERBAR
     =========================== */
  footer{margin-top:30px;background:#000;color:#fff;text-align:center;padding:16px}
  .footerbar{position:fixed;left:0;right:0;bottom:0;background:#0b0b0b;color:#fff;padding:8px 12px;border-top:1px solid rgba(255,255,255,0.03);display:flex;align-items:center;justify-content:center;gap:14px;z-index:1400}

  /* ===========================
     UTILS & RESPONSIVE
     =========================== */
  .hidden{display:none}
  .muted{color:var(--muted)}
  @media (max-width:900px){
    .slides{min-height:220px}
    .card .thumb{height:140px}
    .brand{font-size:1.05rem}
  }

  /* subtle fade-in helper */
  .fade-in{opacity:0;transform:translateY(10px);transition:opacity .5s var(--ease),transform .5s var(--ease)}
  .fade-in.in{opacity:1;transform:none}
  </style>
</head>
<body>
  <!-- HEADER -->
  <header>
    <div class="header-inner">
      <div style="display:flex;align-items:center;gap:18px">
        <a class="brand" href="#home" data-link>TRIVORA</a>
        <nav class="nav" aria-label="menu superior">
          <a href="#home" data-link class="nav-link">Home</a>
          <a href="#produtos" data-link class="nav-link">Produtos</a>
          <a href="#ofertas" data-link class="nav-link">Ofertas</a>
        </nav>
      </div>
      <div class="controls">
        <div class="search" role="search" aria-label="buscar">
          <input id="search" placeholder="Buscar produtos..." aria-label="buscar produtos"/>
          <button id="btn-search" aria-label="buscar">üîç</button>
        </div>
        <div class="minicart" id="minicart" title="Ver carrinho" data-link>
          üõí <span style="margin-left:8px">Carrinho</span> <span style="margin-left:8px;font-weight:700" id="cart-count">0</span>
        </div>
        <button id="btn-auth" class="btn ghost">Entrar / Registar</button>
      </div>
    </div>
  </header>

  <!-- MAIN -->
  <main class="container" id="app">
    <!-- HERO / BANNER -->
    <section id="home" class="fade-in in" aria-labelledby="home-title" style="margin-top:18px">
      <div class="hero" role="region" aria-label="Promo√ß√µes">
        <div class="slides" id="slides">
          <div class="slide active" data-i="0">
            <div class="inner">
              <h1 id="home-title">Bem-vindo √† Trivora</h1>
              <p class="muted">Tecnologia, mobilidade e estilo ‚Äî destaque da semana.</p>
              <a class="cta" href="#produtos" data-link>Ver produtos</a>
            </div>
          </div>
          <div class="slide" data-i="1">
            <div class="inner">
              <h1>Ofertas da Semana</h1>
              <p class="muted">Descontos especiais em sele√ß√£o de produtos.</p>
              <a class="cta" href="#ofertas" data-link>Ver ofertas</a>
            </div>
          </div>
          <div class="slide" data-i="2">
            <div class="inner">
              <h1>Espa√ßo de Marketing</h1>
              <p class="muted">Destaque o seu produto na vitrine principal.</p>
              <a class="cta" href="#marketing" data-link>Saiba mais</a>
            </div>
          </div>
        </div>
        <div class="dots" id="dots"></div>
      </div>

      <!-- CATEGORIES BAR (vis√≠vel e clic√°vel) -->
      <div class="category-bar" id="category-bar" aria-label="Categorias principais" role="navigation">
        <!-- pills injected by JS -->
      </div>

      <!-- HOME: Destaques (apenas) -->
      <div style="margin-top:18px">
        <div class="section-title">
          <h2>Destaques</h2>
          <div class="see-all"><a href="#produtos" data-link>Ver todos</a></div>
        </div>
        <div id="featured" class="cards" aria-live="polite">
          <!-- featured cards injected by JS -->
        </div>
      </div>
    </section>

    <!-- PRODUCTS PAGE -->
    <section id="produtos" class="fade-in hidden">
      <div style="display:flex;justify-content:space-between;align-items:center">
        <h1>Produtos</h1>
        <div>
          <label class="muted">Filtrar: </label>
          <select id="filter-select" aria-label="Filtrar por categoria">
            <option value="all">Todas</option>
          </select>
        </div>
      </div>
      <div id="all-products" class="cards" style="margin-top:16px"></div>
    </section>

    <!-- Category pages (one section per category) -->
    <section id="carros" class="category-section fade-in hidden"><h3>Carros</h3><div id="cat-carros" class="cards"></div></section>
    <section id="motos" class="category-section fade-in hidden"><h3>Motorizadas</h3><div id="cat-motos" class="cards"></div></section>
    <section id="telefones" class="category-section fade-in hidden"><h3>Telefones</h3><div id="cat-telefones" class="cards"></div></section>
    <section id="eletronicos" class="category-section fade-in hidden"><h3>Eletr√¥nicos</h3><div id="cat-eletronicos" class="cards"></div></section>
    <section id="masculino" class="category-section fade-in hidden"><h3>Universo Masculino</h3><div id="cat-masculino" class="cards"></div></section>
    <section id="feminino" class="category-section fade-in hidden"><h3>Universo Feminino & Beleza</h3><div id="cat-feminino" class="cards"></div></section>
    <section id="infantil" class="category-section fade-in hidden"><h3>Infantil</h3><div id="cat-infantil" class="cards"></div></section>
    <section id="servicos" class="category-section fade-in hidden"><h3>Servi√ßos Online</h3><div id="cat-servicos" class="cards"></div></section>
    <section id="marketing" class="category-section fade-in hidden"><h3>Espa√ßo de Marketing</h3><div id="cat-marketing" class="cards"></div></section>

    <!-- CART -->
    <section id="carrinho" class="fade-in hidden">
      <h1>Seu Carrinho</h1>
      <table class="table" id="cart-table">
        <thead><tr><th>Produto</th><th>Pre√ßo</th><th>Qtd</th><th>Subtotal</th><th></th></tr></thead>
        <tbody></tbody>
        <tfoot><tr><td colspan="3">Total</td><td id="cart-total">Kz 0</td><td></td></tr></tfoot>
      </table>
      <div style="margin-top:12px;display:flex;gap:10px;justify-content:flex-end">
        <button class="btn" id="btn-checkout">Finalizar Compra</button>
        <button class="btn ghost" id="btn-clear">Limpar Carrinho</button>
      </div>
    </section>

    <!-- CHECKOUT -->
    <section id="checkout" class="fade-in hidden">
      <h1>Finalizar Compra</h1>
      <div style="display:grid;grid-template-columns:1fr 360px;gap:18px">
        <form id="checkout-form" class="form" autocomplete="on">
          <input name="name" placeholder="Nome completo" required />
          <input name="email" type="email" placeholder="Email (receber confirma√ß√£o)" required />
          <input name="address" placeholder="Endere√ßo (rua, n¬∫, cidade)" required />
          <input name="phone" placeholder="Telefone" />
          <select name="payment" required>
            <option value="">M√©todo de Pagamento</option>
            <option>Multicaixa</option>
            <option>Unitel Money</option>
            <option>PayPal</option>
            <option>Stripe</option>
          </select>
          <textarea name="notes" placeholder="Observa√ß√µes (opcional)"></textarea>
          <button class="cta" type="submit">Confirmar pedido (simulado)</button>
        </form>
        <aside style="border:1px solid #eee;border-radius:10px;padding:12px">
          <h3>Resumo do pedido</h3>
          <table class="table" id="summary-table">
            <thead><tr><th>Produto</th><th>Qtd</th><th>Total</th></tr></thead>
            <tbody></tbody>
            <tfoot><tr><td colspan="2">Total</td><td id="summary-total">Kz 0</td></tr></tfoot>
          </table>
        </aside>
      </div>
    </section>

    <!-- CONTA -->
    <section id="conta" class="fade-in hidden">
      <h1>Minha Conta</h1>
      <div id="account-area"></div>
    </section>

  </main>

  <!-- FOOTER -->
  <footer>
    <div class="container footer-inner">
      <div style="display:flex;justify-content:space-between;align-items:center;gap:12px;flex-wrap:wrap">
        <div>&copy; <span id="year"></span> Trivora ‚Äî Mobilidade, Tecnologia & Estilo</div>
        <div style="display:flex;gap:12px">
          <a href="#contato" data-link>Contato</a> ‚Ä¢ <a href="#politica" data-link>Pol√≠tica</a>
        </div>
      </div>
    </div>
  </footer>

  <!-- FOOTERBAR -->
  <div class="footerbar" role="navigation" aria-label="barra inferior">
    <a href="#home" data-link>Home</a>
    <a href="#produtos" data-link>Produtos</a>
    <a href="#carrinho" data-link>Carrinho</a>
    <a href="#conta" data-link>Conta</a>
  </div>

  <!-- AUTH MODAL -->
  <div id="auth-modal" class="modal-backdrop" aria-hidden="true">
    <div class="modal" role="dialog" aria-modal="true" aria-labelledby="auth-title" style="position:relative">
      <span class="close" id="auth-close" title="Fechar">‚úï</span>
      <h3 id="auth-title">Entrar na Trivora</h3>
      <p class="muted">Fa√ßa login com Google (opcional) ou continue como convidado. Login √© exigido apenas para finalizar compras e ver pedidos.</p>
      <div style="display:flex;gap:8px;flex-wrap:wrap;margin-top:12px">
        <button id="btn-google" class="btn">Entrar com Google</button>
        <button id="btn-guest" class="btn ghost">Continuar como Convidado</button>
      </div>
      <hr style="margin:12px 0;border:none;border-top:1px solid #eee"/>
      <div>
        <form id="local-login-form" class="form" style="margin-top:8px">
          <input name="name" placeholder="Nome (criar conta local / teste)" />
          <input name="email" placeholder="Email" type="email" />
          <input name="password" placeholder="Senha (opcional)" type="password" />
          <div style="display:flex;gap:8px;margin-top:8px">
            <button type="submit" class="btn">Registrar / Entrar</button>
            <button type="button" id="auth-cancel" class="btn ghost">Cancelar</button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <!-- QUICKVIEW -->
  <div id="quickview-modal" class="modal-backdrop" aria-hidden="true">
    <div class="modal" id="quickview-content" style="position:relative">
      <span class="close" id="qv-close" title="Fechar">‚úï</span>
      <!-- content injected by JS -->
    </div>
  </div>

  <!-- TOAST -->
  <div id="toast-wrap" style="position:fixed;left:50%;transform:translateX(-50%);top:18px;z-index:3000"></div>

  <!-- PART 2: JavaScript - cola a Parte 2 aqui -->
  <script>
  /************************************************************************
   * TRIVORA ‚Äî Single page JS
   * - Produtos com categoria e reviews
   * - Destaques (home)
   * - Categorias vis√≠veis (faixa)
   * - Carrinho (localStorage)
   * - Checkout simulado (Multicaixa, Unitel Money, PayPal, Stripe)
   * - Login opcional (Google toggle) + guest + local fallback
   * - QuickView modal e anima√ß√µes
   ************************************************************************/

  // ---------- CONFIG ----------
  const FIREBASE_ENABLED = false; // set true + provide config to enable real Google
  const firebaseConfig = {
    apiKey: "YOUR_API_KEY",
    authDomain: "YOUR_PROJECT.firebaseapp.com",
    projectId: "YOUR_PROJECT_ID",
    appId: "YOUR_APP_ID"
  };

  // ---------- DATA: products (with featured + rating) ----------
  const PRODUCTS = [
    {id:'car-tesla',category:'Carros',name:'Tesla Model 3',price:9500000,img:'https://source.unsplash.com/900x700/?tesla,car',desc:'El√©trico, autonomia e tecnologia.',featured:true,rating:4.9,reviews:1245},
    {id:'car-bmw',category:'Carros',name:'BMW S√©rie 3',price:8200000,img:'https://source.unsplash.com/900x700/?bmw,car',desc:'Performance e luxo.',featured:false,rating:4.7,reviews:842},
    {id:'car-audi',category:'Carros',name:'Audi A4',price:7800000,img:'https://source.unsplash.com/900x700/?audi,car',desc:'Conforto e eleg√¢ncia.',featured:false,rating:4.6,reviews:623},
    {id:'car-suvx',category:'Carros',name:'SUV Advent X',price:7200000,img:'https://source.unsplash.com/900x700/?suv,car',desc:'Espa√ßo e robustez.',featured:true,rating:4.5,reviews:412},
    {id:'moto-r1',category:'Motorizadas',name:'Yamaha R1',price:3200000,img:'https://source.unsplash.com/900x700/?yamaha,motorcycle',desc:'Esportiva potente.',featured:true,rating:4.8,reviews:978},
    {id:'moto-cbr',category:'Motorizadas',name:'Honda CBR600',price:2800000,img:'https://source.unsplash.com/900x700/?honda,motorcycle',desc:'Agilidade e controle.',featured:false,rating:4.6,reviews:402},
    {id:'tel-iphone15',category:'Telefones',name:'iPhone 15 Pro',price:850000,img:'https://source.unsplash.com/900x700/?iphone,phone',desc:'C√¢mera e performance.',featured:true,rating:4.9,reviews:5521},
    {id:'tel-galaxy',category:'Telefones',name:'Samsung Galaxy S24',price:620000,img:'https://source.unsplash.com/900x700/?samsung,phone',desc:'Tela AMOLED.',featured:false,rating:4.7,reviews:2411},
    {id:'ele-tv55',category:'Eletronicos',name:'Smart TV 55"',price:300000,img:'https://source.unsplash.com/900x700/?tv,television',desc:'4K HDR e apps.',featured:true,rating:4.6,reviews:900},
    {id:'ele-laptop',category:'Eletronicos',name:'Ultrabook Pro',price:540000,img:'https://source.unsplash.com/900x700/?laptop,notebook',desc:'Leve e potente.',featured:false,rating:4.5,reviews:720},
    {id:'mas-tenis',category:'Masculino',name:'T√™nis Running',price:45000,img:'https://source.unsplash.com/900x700/?mens-shoes',desc:'Conforto e estilo.',featured:true,rating:4.4,reviews:311},
    {id:'fem-vestido',category:'Feminino',name:'Vestido Floral',price:25000,img:'https://source.unsplash.com/900x700/?dress,women',desc:'Leve e elegante.',featured:true,rating:4.3,reviews:210},
    {id:'bez-kit',category:'Beleza',name:'Kit Maquiagem',price:15000,img:'https://source.unsplash.com/900x700/?makeup,cosmetics',desc:'Completo para o dia a dia.',featured:false,rating:4.2,reviews:155},
    {id:'inf-conj',category:'Infantil',name:'Conjunto Infantil',price:15000,img:'https://source.unsplash.com/900x700/?kids,clothes',desc:'Conforto para os pequenos.',featured:false,rating:4.6,reviews:98},
    {id:'srv-logo',category:'Servicos',name:'Design de Logo',price:20000,img:'https://source.unsplash.com/900x700/?logo,design',desc:'Identidade visual profissional.',featured:false,rating:4.8,reviews:43},
    {id:'mkt-ad',category:'Marketing',name:'An√∫ncio em Destaque',price:10000,img:'https://source.unsplash.com/900x700/?marketing,advertising',desc:'Promova seu produto na homepage.',featured:true,rating:4.7,reviews:11},
    // filler
    {id:'car-eco',category:'Carros',name:'Compact Eco',price:3200000,img:'https://source.unsplash.com/900x700/?compact,car',desc:'Econ√¥mico e urbano.',featured:false,rating:4.1,reviews:77},
    {id:'moto-off',category:'Motorizadas',name:'OffRoad Pro',price:2100000,img:'https://source.unsplash.com/900x700/?offroad,motorcycle',desc:'Aventura sem limites.',featured:false,rating:4.5,reviews:64},
    {id:'tel-pixel',category:'Telefones',name:'Google Pixel 8',price:480000,img:'https://source.unsplash.com/900x700/?google,phone',desc:'Android puro e c√¢mera.',featured:false,rating:4.4,reviews:340},
    {id:'ele-head',category:'Eletronicos',name:'Fones Studio',price:45000,img:'https://source.unsplash.com/900x700/?headphones',desc:'Som imersivo.',featured:false,rating:4.3,reviews:243},
    {id:'mas-jaqueta',category:'Masculino',name:'Jaqueta Bomber',price:46000,img:'https://source.unsplash.com/900x700/?mens-jacket',desc:'Estilo urbano.',featured:false,rating:4.2,reviews:132},
    {id:'fem-bolsa',category:'Feminino',name:'Bolsa Tiracolo',price:52000,img:'https://source.unsplash.com/900x700/?womens-bag',desc:'Acabamento premium.',featured:false,rating:4.1,reviews:88},
    {id:'inf-brinq',category:'Infantil',name:'Brinquedo Educativo',price:8000,img:'https://source.unsplash.com/900x700/?toy',desc:'Aprendizado divertido.',featured:false,rating:4.6,reviews:56},
    {id:'srv-seo',category:'Marketing',name:'Pacote SEO',price:25000,img:'https://source.unsplash.com/900x700/?seo',desc:'Apare√ßa no topo das buscas.',featured:false,rating:4.6,reviews:29},
  ];

  // ---------- STORAGE ----------
  const KEY = {
    CART: 'trivora_cart_v3',
    ORDERS: 'trivora_orders_v3',
    SESSION: 'trivora_session_v3'
  };
  function getStore(k, fallback=[]){ try{ const v = localStorage.getItem(k); return v?JSON.parse(v):fallback }catch(e){ return fallback } }
  function setStore(k,v){ try{ localStorage.setItem(k, JSON.stringify(v)); }catch(e){} }

  // ---------- CART API ----------
  function cartAll(){ return getStore(KEY.CART, []); }
  function cartSave(arr){ setStore(KEY.CART, arr); UI.updateCart(); }
  function cartAdd(id, qty=1){
    const items = cartAll();
    const it = items.find(x=>x.id===id);
    const p = PRODUCTS.find(x=>x.id===id);
    if(it) it.qty += qty; else items.push({id, qty, name: p? p.name : 'Produto', price: p? p.price : 0});
    cartSave(items); UI.toast('Adicionado ao carrinho');
  }
  function cartRemove(id){ cartSave(cartAll().filter(x=>x.id !== id)); }
  function cartSetQty(id, qty){ const items = cartAll(); const it = items.find(x=>x.id===id); if(it){ it.qty = Math.max(1, qty); cartSave(items); } }
  function cartClear(){ cartSave([]); }

  // ---------- ORDERS ----------
  function ordersAll(){ return getStore(KEY.ORDERS, []); }
  function createOrder(order){ const list = ordersAll(); list.unshift(order); setStore(KEY.ORDERS, list); return order; }

  // ---------- AUTH (local/session + optional firebase) ----------
  function getSession(){ return JSON.parse(localStorage.getItem(KEY.SESSION) || 'null'); }
  function setSession(sess){ localStorage.setItem(KEY.SESSION, JSON.stringify(sess)); UI.updateAccountUI(); }
  function clearSession(){ localStorage.removeItem(KEY.SESSION); UI.updateAccountUI(); }

  // firebase optional loading (not active by default)
  if(FIREBASE_ENABLED){
    (async ()=>{
      try{
        const { initializeApp } = await import('https://www.gstatic.com/firebasejs/10.14.1/firebase-app.js');
        const { getAuth, signInWithPopup, GoogleAuthProvider, onAuthStateChanged, signOut } = await import('https://www.gstatic.com/firebasejs/10.14.1/firebase-auth.js');
        const app = initializeApp(firebaseConfig);
        window._TRIVORA_FIREBASE = { initializeApp: app, getAuth, signInWithPopup, GoogleAuthProvider, onAuthStateChanged, signOut, auth: getAuth(app) };
      }catch(e){ console.warn('Firebase load fail', e); }
    })();
  }

  // ---------- UI HELPERS ----------
  const UI = {
    toast(msg, ms=1600){
      const wrap = document.getElementById('toast-wrap');
      const el = document.createElement('div'); el.className = 'toast'; el.textContent = msg;
      wrap.appendChild(el); setTimeout(()=> el.remove(), ms);
    },
    updateCart(){
      const count = cartAll().reduce((s,i)=>s+i.qty,0);
      document.getElementById('cart-count').textContent = count;
      const totalEl = document.getElementById('cart-total');
      if(totalEl){
        const total = cartAll().reduce((s,i)=>{ const p = PRODUCTS.find(x=>x.id===i.id); return s + ((p?.price||i.price||0) * i.qty); },0);
        totalEl.textContent = formatKz(total);
      }
    },
    updateAccountUI(){
      const sess = getSession();
      const btn = document.getElementById('btn-auth');
      if(sess){
        btn.textContent = sess.name ? `Ol√°, ${sess.name.split(' ')[0]}` : 'Minha Conta';
        btn.classList.add('ghost');
      } else {
        btn.textContent = 'Entrar / Registar';
        btn.classList.remove('ghost');
      }
      // account area
      const area = document.getElementById('account-area');
      if(area){
        if(sess){
          const orders = ordersAll().filter(o => (o.user && o.user.email) === sess.email || (o.customer && o.customer.email) === sess.email);
          area.innerHTML = `<div style="display:flex;justify-content:space-between;align-items:center"><div><h3>${escapeHtml(sess.name||sess.email)}</h3><div class="muted">${escapeHtml(sess.email||'')}</div></div><div><button id="logout-now" class="btn ghost">Sair</button></div></div>
            <div style="margin-top:12px"><h4>Pedidos</h4>${orders.length ? orders.map(o=>`<div style="border:1px solid #eee;padding:10px;border-radius:8px;margin-bottom:8px">${o.id} ‚Äî ${new Date(o.createdAt).toLocaleString()} ‚Äî ${formatKz(o.total)} ‚Äî ${o.status}</div>`).join('') : '<div class="muted">Nenhum pedido</div>'}</div>`;
          document.getElementById('logout-now').addEventListener('click', ()=>{ clearSession(); UI.toast('Sess√£o encerrada'); location.hash='home'; showRoute(); });
        } else {
          area.innerHTML = '<div class="muted">Fa√ßa login para ver pedidos.</div>';
        }
      }
    }
  };

  function formatKz(v){ return 'Kz ' + Number(v).toLocaleString('pt-PT'); }
  function escapeHtml(s){ return String(s||'').replace(/[&<>"']/g,c=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#039;'})[c]); }

  // ---------- RENDER: categories bar, featured, products ----------
  function uniqueCategories(){
    const cats = Array.from(new Set(PRODUCTS.map(p=>p.category)));
    // Put Marketing & Servicos last for prominence
    const prioritized = ['Carros','Motorizadas','Telefones','Eletronicos','Masculino','Feminino','Infantil','Beleza','Servicos','Marketing'];
    return prioritized.filter(x=>cats.includes(x)).concat(cats.filter(x=>!prioritized.includes(x)));
  }

  function renderCategoryBar(){
    const bar = document.getElementById('category-bar');
    const cats = uniqueCategories();
    bar.innerHTML = cats.map((c,i)=> `<button class="cat-pill" data-cat="${escapeHtml(c)}">${escapeHtml(c)}</button>`).join('');
    bar.querySelectorAll('.cat-pill').forEach(p=>{
      p.addEventListener('click', ()=>{ document.querySelectorAll('.cat-pill').forEach(x=>x.classList.remove('active')); p.classList.add('active'); location.hash = slug(p.dataset.cat); });
    });
  }

  function renderFeatured(){
    const out = document.getElementById('featured');
    const list = PRODUCTS.filter(p=>p.featured);
    out.innerHTML = list.map(renderCard).join('');
    bindCardActions(out);
  }

  function renderAllProducts(filter='all'){
    const out = document.getElementById('all-products');
    let list = PRODUCTS.slice();
    if(filter && filter !== 'all') list = list.filter(p=>p.category === filter);
    out.innerHTML = list.map(renderCardWithRating).join('');
    bindCardActions(out);
  }

  function renderCard(p){
    return `<article class="card" data-id="${p.id}">
      <div class="thumb"><img src="${p.img}" alt="${escapeHtml(p.name)}"></div>
      <div class="meta">
        <h4>${escapeHtml(p.name)}</h4>
        <p class="muted">${escapeHtml(p.desc)}</p>
        <div style="display:flex;justify-content:space-between;align-items:center">
          <div class="price">${formatKz(p.price)}</div>
          <div class="rating"><span class="stars">${stars(p.rating)}</span><small class="muted">(${p.reviews})</small></div>
        </div>
      </div>
      <div class="actions">
        <button class="btn" data-add="${p.id}">Adicionar</button>
        <button class="btn ghost" data-view="${p.id}">Ver</button>
      </div>
    </article>`;
  }

  function renderCardWithRating(p){
    // slightly larger description in products page
    return `<article class="card" data-id="${p.id}">
      <div class="thumb"><img src="${p.img}" alt="${escapeHtml(p.name)}"></div>
      <div class="meta">
        <h4>${escapeHtml(p.name)}</h4>
        <p class="muted">${escapeHtml(p.desc)}</p>
        <div style="display:flex;justify-content:space-between;align-items:center">
          <div class="price">${formatKz(p.price)}</div>
          <div class="rating"><span class="stars">${stars(p.rating)}</span><small class="muted"> ${p.reviews} reviews</small></div>
        </div>
      </div>
      <div class="actions">
        <button class="btn" data-add="${p.id}">Adicionar</button>
        <button class="btn ghost" data-view="${p.id}">Ver</button>
      </div>
    </article>`;
  }

  function stars(score){
    const full = Math.floor(score);
    const half = score - full >= 0.5 ? 1 : 0;
    const empty = 5 - full - half;
    return '‚òÖ'.repeat(full) + (half? '¬Ω' : '') + '‚òÜ'.repeat(empty);
  }

  function bindCardActions(root){
    root.querySelectorAll('[data-add]').forEach(btn=>{
      btn.removeEventListener('click', addHandler);
      btn.addEventListener('click', addHandler);
    });
    root.querySelectorAll('[data-view]').forEach(btn=>{
      btn.removeEventListener('click', viewHandler);
      btn.addEventListener('click', viewHandler);
    });
  }

  function addHandler(e){ const id = e.currentTarget.dataset.add; cartAdd(id,1); renderCartTable(); UI.updateCart(); }
  function viewHandler(e){ const id = e.currentTarget.dataset.view; const p = PRODUCTS.find(x=>x.id===id); if(p) openQuickView(p); }

  // ---------- QUICKVIEW ----------
  const qvModal = document.getElementById('quickview-modal');
  const qvContent = document.getElementById('quickview-content');
  const qvClose = document.getElementById('qv-close');

  function openQuickView(p){
    qvContent.querySelectorAll('.qv-inner').forEach(x=>x.remove());
    const el = document.createElement('div'); el.className = 'qv-inner';
    el.innerHTML = `<div style="display:flex;gap:12px;flex-wrap:wrap">
      <div style="flex:1;min-width:260px"><img src="${p.img}" alt="${escapeHtml(p.name)}" style="width:100%;height:320px;object-fit:cover;border-radius:8px"></div>
      <div style="flex:1;min-width:240px">
        <h3>${escapeHtml(p.name)}</h3>
        <div style="font-weight:800;margin:8px 0">${formatKz(p.price)}</div>
        <div class="rating"><span class="stars">${stars(p.rating)}</span><small class="muted"> ${p.reviews} reviews</small></div>
        <p class="muted" style="margin-top:10px">${escapeHtml(p.desc)}</p>
        <div style="margin-top:12px;display:flex;gap:8px">
          <button class="btn" id="qv-add">Adicionar</button>
          <button class="btn ghost" id="qv-close-btn">Fechar</button>
        </div>
      </div>
    </div>`;
    qvContent.appendChild(el);
    qvModal.style.display = 'flex';
    document.getElementById('qv-add').addEventListener('click', ()=>{ cartAdd(p.id,1); renderCartTable(); UI.updateCart(); qvModal.style.display='none'; });
    document.getElementById('qv-close-btn').addEventListener('click', ()=> qvModal.style.display='none');
  }
  qvClose && qvClose.addEventListener('click', ()=> qvModal.style.display='none');
  qvModal.addEventListener('click', (e)=> { if(e.target === qvModal) qvModal.style.display='none'; });

  // ---------- CART UI ----------
  function renderCartTable(){
    const tbody = document.querySelector('#cart-table tbody');
    if(!tbody) return;
    const items = cartAll();
    if(items.length === 0){ tbody.innerHTML = '<tr><td colspan="5" class="muted">Carrinho vazio</td></tr>'; UI.updateCart(); return; }
    tbody.innerHTML = items.map(it=>{
      const p = PRODUCTS.find(x=>x.id===it.id) || {name:it.name, price:it.price};
      const subtotal = (p.price || it.price || 0) * it.qty;
      return `<tr>
        <td style="max-width:320px">${escapeHtml(p.name)}</td>
        <td>${formatKz(p.price || it.price || 0)}</td>
        <td><input class="qty-input" data-id="${it.id}" type="number" min="1" value="${it.qty}"></td>
        <td>${formatKz(subtotal)}</td>
        <td><button class="btn ghost" data-remove="${it.id}">Remover</button></td>
      </tr>`;
    }).join('');
    tbody.querySelectorAll('.qty-input').forEach(i=>{ i.removeEventListener('input', qtyCh); i.addEventListener('input', qtyCh); });
    tbody.querySelectorAll('[data-remove]').forEach(b=>{ b.removeEventListener('click', removeItem); b.addEventListener('click', removeItem); });
    UI.updateCart();
  }
  function qtyCh(e){ const id = e.currentTarget.dataset.id; const v = parseInt(e.currentTarget.value||'1',10); cartSetQty(id, v); renderCartTable(); }
  function removeItem(e){ const id = e.currentTarget.dataset.remove; cartRemove(id); renderCartTable(); UI.updateCart(); }

  // ---------- CHECKOUT ----------
  const checkoutForm = document.getElementById('checkout-form');
  checkoutForm && checkoutForm.addEventListener('submit', (e) => {
    e.preventDefault();
    const form = new FormData(e.target); const customer = Object.fromEntries(form.entries());
    const items = cartAll();
    if(items.length === 0){ UI.toast('Carrinho vazio'); location.hash='carrinho'; showRoute(); return; }
    const sess = getSession();
    if(!sess){ UI.toast('Fa√ßa login ou continue como convidado'); openAuthModal(); return; }
    if(sess.type === 'guest' && (!customer.email || customer.email.trim() === '')){ UI.toast('Forne√ßa um email para confirma√ß√£o'); return; }
    const total = items.reduce((s,i)=>{ const p = PRODUCTS.find(x=>x.id===i.id); return s + ((p?.price||0) * i.qty); },0);
    const order = { id:'TRV-'+Date.now(), items, total, customer, status:'Pago (simulado)', createdAt:new Date().toISOString(), user: sess };
    createOrder(order);
    cartClear(); renderCartTable(); UI.updateCart();
    UI.toast('Pedido confirmado (simula√ß√£o): ' + order.id, 2200);
    setTimeout(()=>{ location.hash='conta'; showRoute(); renderAccount(); }, 700);
  });

  function renderCheckoutSummary(){
    const tb = document.querySelector('#summary-table tbody');
    if(!tb) return;
    const items = cartAll();
    if(items.length === 0){ tb.innerHTML = '<tr><td colspan="3">Carrinho vazio</td></tr>'; document.getElementById('summary-total').textContent = 'Kz 0'; return; }
    tb.innerHTML = items.map(it=>{ const p = PRODUCTS.find(x=>x.id===it.id); return `<tr><td>${escapeHtml(p.name)}</td><td>${it.qty}</td><td>${formatKz((p.price||0)*it.qty)}</td></tr>`; }).join('');
    const total = items.reduce((s,i)=>{ const p = PRODUCTS.find(x=>x.id===i.id); return s + ((p?.price||0) * i.qty); },0);
    document.getElementById('summary-total').textContent = formatKz(total);
  }

  // ---------- AUTH MODAL ----------
  const authModal = document.getElementById('auth-modal');
  const btnAuth = document.getElementById('btn-auth');
  const btnGoogle = document.getElementById('btn-google');
  const btnGuest = document.getElementById('btn-guest');
  const authClose = document.getElementById('auth-close');
  const localLoginForm = document.getElementById('local-login-form');

  function openAuthModal(){ authModal.style.display = 'flex'; authModal.setAttribute('aria-hidden','false'); }
  function closeAuthModal(){ authModal.style.display = 'none'; authModal.setAttribute('aria-hidden','true'); }

  btnAuth.addEventListener('click', ()=>{ const s = getSession(); if(s) { location.hash='conta'; showRoute(); } else openAuthModal(); });
  authClose.addEventListener('click', closeAuthModal);
  authModal.addEventListener('click', (e)=>{ if(e.target === authModal) closeAuthModal(); });

  // guest flow
  btnGuest.addEventListener('click', ()=>{ setSession({ type:'guest', name:'Convidado', email:null }); UI.toast('Continuando como convidado'); closeAuthModal(); });

  // local registration/login
  localLoginForm && localLoginForm.addEventListener('submit', (e) => {
    e.preventDefault();
    const f = new FormData(e.target); const name = f.get('name') || 'Usu√°rio'; const email = f.get('email') || null;
    if(!email){ UI.toast('Forne√ßa um email v√°lido'); return; }
    setSession({ type:'user', name, email, uid: 'local-'+Date.now() });
    UI.toast('Sess√£o iniciada: ' + name);
    closeAuthModal();
  });

  // google login (fallback simulation if firebase disabled)
  btnGoogle.addEventListener('click', async ()=>{
    if(FIREBASE_ENABLED && window._TRIVORA_FIREBASE && window._TRIVORA_FIREBASE.signInWithPopup){
      try{
        const provider = new window._TRIVORA_FIREBASE.GoogleAuthProvider();
        const res = await window._TRIVORA_FIREBASE.signInWithPopup(window._TRIVORA_FIREBASE.auth, provider);
        const u = res.user;
        setSession({ type:'user', uid: u.uid, name: u.displayName, email: u.email });
        UI.toast('Bem-vindo, ' + u.displayName);
        closeAuthModal();
      }catch(err){ UI.toast('Erro Google: ' + (err.message||err)); }
    } else {
      // fallback -> prompt
      const name = prompt('Nome (simula√ß√£o Google):'); if(!name) return;
      const email = prompt('Email (simula√ß√£o):'); if(!email) return;
      setSession({ type:'user', name, email, uid: 'sim-'+Date.now() });
      UI.toast('Login simulado: ' + name);
      closeAuthModal();
    }
  });

  // ---------- ACCOUNT ----------
  function renderAccount(){
    const area = document.getElementById('account-area');
    const sess = getSession();
    if(!area) return;
    if(!sess){ area.innerHTML = '<div class="muted">Fa√ßa login para ver pedidos.</div>'; return; }
    const orders = ordersAll().filter(o => (o.user && o.user.email) === sess.email || (o.customer && o.customer.email) === sess.email);
    area.innerHTML = `<div style="display:flex;justify-content:space-between;align-items:center"><div><h3>${escapeHtml(sess.name||sess.email)}</h3><div class="muted">${escapeHtml(sess.email||'')}</div></div><div><button id="logoutNow" class="btn ghost">Sair</button></div></div>
      <div style="margin-top:12px"><h4>Pedidos</h4>${orders.length ? orders.map(o=>`<div style="border:1px solid #eee;padding:10px;border-radius:8px;margin-bottom:8px">${o.id} ‚Äî ${new Date(o.createdAt).toLocaleString()} ‚Äî ${formatKz(o.total)} ‚Äî ${o.status}</div>`).join('') : '<div class="muted">Nenhum pedido</div>'}</div>`;
    document.getElementById('logoutNow').addEventListener('click', ()=>{ clearSession(); UI.toast('Saiu da conta'); location.hash='home'; showRoute(); });
  }

  // ---------- SEARCH & FILTER ----------
  document.getElementById('btn-search').addEventListener('click', ()=>{
    const q = (document.getElementById('search').value||'').trim().toLowerCase();
    if(!q){ location.hash='produtos'; showRoute(); return; }
    const list = PRODUCTS.filter(p => p.name.toLowerCase().includes(q) || p.desc.toLowerCase().includes(q) || p.category.toLowerCase().includes(q));
    document.getElementById('produtos').classList.remove('hidden'); document.getElementById('home').classList.add('hidden');
    document.getElementById('all-products').innerHTML = list.map(renderCardWithRating).join('');
    bindCardActions(document.getElementById('all-products'));
    location.hash='produtos';
  });

  // filter select populate
  (function populateFilter(){
    const sel = document.getElementById('filter-select');
    uniqueCategories().forEach(c=>{ const opt = document.createElement('option'); opt.value=c; opt.textContent=c; sel.appendChild(opt); });
    sel.addEventListener('change', ()=> renderAllProducts(sel.value));
  })();

  // ---------- ROUTING ----------
  function slug(s){ return s.toLowerCase().replace(/\s+/g,''); }

  function showRoute(){
    const h = (location.hash || '#home').replace('#','');
    document.querySelectorAll('main section').forEach(s=> s.classList.add('hidden'));
    if(h===''||h==='home'){ document.getElementById('home').classList.remove('hidden'); }
    else if(h==='produtos'){ document.getElementById('produtos').classList.remove('hidden'); renderAllProducts(); }
    else if(h==='carrinho'){ document.getElementById('carrinho').classList.remove('hidden'); renderCartTable(); UI.updateCart(); }
    else if(h==='checkout'){ document.getElementById('checkout').classList.remove('hidden'); renderCheckoutSummary(); }
    else if(h==='conta'){ document.getElementById('conta').classList.remove('hidden'); renderAccount(); }
    else {
      // category mapping keys
      const map = {carros:'Carros',motos:'Motorizadas',telefones:'Telefones',eletronicos:'Eletronicos',masculino:'Masculino',feminino:'Feminino',infantil:'Infantil',servicos:'Servicos',marketing:'Marketing'};
      if(map[h]){ document.getElementById(h).classList.remove('hidden'); renderCategoryPage(map[h], 'cat-'+h); }
      else document.getElementById('home').classList.remove('hidden');
    }
    // nav highlight
    document.querySelectorAll('.nav a').forEach(a=>{ const href = (a.getAttribute('href')||'').replace('#','') || 'home'; a.classList.toggle('active', href === (location.hash.replace('#','')||'home')); });
    // show checkout summary when needed
    if(location.hash.replace('#','') === 'checkout') renderCheckoutSummary();
  }
  window.addEventListener('hashchange', showRoute);

  function renderCategoryPage(category, elId){
    const el = document.getElementById(elId);
    if(!el) return;
    const list = PRODUCTS.filter(p=>p.category === category);
    if(list.length === 0){ el.innerHTML = '<div class="muted">Sem produtos nesta categoria.</div>'; return; }
    el.innerHTML = list.map(renderCardWithRating).join('');
    bindCardActions(el);
  }

  // ---------- INITIAL RENDER ----------
  function renderInitial(){
    renderCategoryBar();
    renderFeatured();
    renderAllProducts('all');
    // pre-render categories
    const pairs = {carros:'Carros',motos:'Motorizadas',telefones:'Telefones',eletronicos:'Eletronicos',masculino:'Masculino',feminino:'Feminino',infantil:'Infantil',servicos:'Servicos',marketing:'Marketing'};
    Object.keys(pairs).forEach(k=> renderCategoryPage(pairs[k], 'cat-'+k));
    // slider
    initSlider();
    UI.updateCart();
    UI.updateAccountUI();
    document.getElementById('year').textContent = new Date().getFullYear();
    // show route
    showRoute();
    // observe fade-in
    document.querySelectorAll('.fade-in').forEach(el=> setTimeout(()=> el.classList.add('in'), 60));
  }

  // ---------- SLIDER ----------
  function initSlider(){
    const slides = Array.from(document.querySelectorAll('.slide'));
    const dots = document.getElementById('dots');
    dots.innerHTML = slides.map((_,i)=> `<div class="dot ${i===0?'active':''}" data-i="${i}"></div>`).join('');
    const dotEls = Array.from(dots.children);
    let idx = 0;
    const show = (i) => { slides.forEach((s,k)=> s.classList.toggle('active', k===i)); dotEls.forEach((d,k)=> d.classList.toggle('active', k===i)); idx = i; };
    dotEls.forEach(d=> d.addEventListener('click', ()=> show(parseInt(d.dataset.i))));
    setInterval(()=> show((idx+1) % slides.length), 5200);
  }

  // ---------- UI interactions ----------
  document.getElementById('minicart').addEventListener('click', ()=>{ location.hash='carrinho'; showRoute(); renderCartTable(); });
  document.getElementById('btn-clear')?.addEventListener('click', ()=>{ cartClear(); renderCartTable(); UI.updateCart(); UI.toast('Carrinho limpo'); });
  document.getElementById('btn-checkout')?.addEventListener('click', ()=>{ const sess = getSession(); if(!sess){ openAuthModal(); UI.toast('Fa√ßa login para finalizar a compra'); return; } location.hash='checkout'; showRoute(); });

  // bind search on Enter
  document.getElementById('search').addEventListener('keydown', (e)=>{ if(e.key === 'Enter'){ document.getElementById('btn-search').click(); } });

  // ---------- small helpers ----------
  function openAuthModal(){ authModal.style.display='flex'; authModal.setAttribute('aria-hidden','false'); }
  function closeAuthModal(){ authModal.style.display='none'; authModal.setAttribute('aria-hidden','true'); }

  // render cart table when opening cart
  function renderCartTableOnOpen(){ renderCartTable(); UI.updateCart(); }

  // ---------- event: persist cart changes on page unload ----------
  window.addEventListener('beforeunload', ()=> { /* already persisted to localStorage */ });

  // ---------- init on DOM ready ----------
  document.addEventListener('DOMContentLoaded', ()=>{ renderInitial(); });

  // Expose for debug
  window.TRIVORA = { PRODUCTS, cartAll, cartAdd, cartRemove, createOrder, getSession, setSession, clearSession };

  </script>
</body>
</html>



